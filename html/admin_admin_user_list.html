<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
	<link rel="stylesheet" type="text/css" href="../css/jquery.bxslider.css">
	<link rel="stylesheet" type="text/css" href="../css/defalut.css">
	<link rel="stylesheet" type="text/css" href="../css/admin_defalut.css">
	<link rel="stylesheet" type="text/css" href="../css/new_style.css">
	<link rel="stylesheet" type="text/css" href="../css/admin.css">
	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
	<script src="http://code.jquery.com/jquery-latest.min.js"></script>
	<script src="../js/admin.js"></script>
	<script src="../js/jquery.bxslider.js"></script>
	<script src="../js/pagination.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/paginationjs/2.1.4/pagination.css"/>
</head>
<body>
	<div class="container">
		<div class="header_messageLine">
			<div class="header_messageLine_message">
				<span class="message_first">
					온라인 셀러들의 도구,
				</span>
				<span class="message_second">
					헬프스토어 셀러퀸즈
				</span>
			</div>
		</div>
		<div class="admin_m_header">
			<div class="ham">
				<span></span>
				<span></span>
				<span></span>
			</div>
			<a href=""><img src="../image/admin_back.png" alt="" /></a>
			<a href="../html/main.html" class="header_gnb_logo">
				<img src="../image/logo.png">
			</a>
			<div>
				<span>김관리자</span> 님
			</div>
		</div>
		<div class="adminContainer admUserList">
			<!-- rightmenu -->
			<div class="rightmenuWrap"></div>
			<div class="adminWrap">
				<div class="adminWrap_topmenu">
					<ul>
						<li class="active"><a href="./admin_admin_main.html">관리자 센터</a></li>
						<li><a href="./admin_seller_main.html">셀러 센터</a></li>
						<li><a href="./admin_domae_main.html">도매 센터</a></li>
						<li><a href="./admin_teacher_main.html">강사 센터</a></li>
					</ul>
				</div>
				 <div class="adminWrap_topmenu adminWrap_topmenu_m">
					<ul>
						<li class="active"><a href="admin_admin_user_list.html">일반 회원 관리</a></li>
						<li><a href="admin_admin_user_list_seller.html">셀러 회원 관리</a></li>
						<li><a href="admin_admin_user_list_domae.html">도매 회원 관리</a></li>
						<li><a href="admin_admin_user_list_teacher.html">강사 회원 관리</a></li>
					</ul>
				</div>
				<div class="adminWrap_title">
					<a href="./admin_admin_main.html"><img src="../image/admin_back.png" alt="" /></a>
					<h3>일반회원관리</h3>
				</div> 
					<div class="adminContent" style="height:auto;">
						<div class="adminContent_tab">
							<ul>
								<li class="active"><a href="">사용자 목록</a></li>
							</ul>
						</div>
						<div class="adminContent_search adminContent_search_long">
							<input type="search" name="search_product" placeholder="사용자 이름/ 아이디/ 가입 마켓을 검색해주세요." onkeyup="enterkey()">
							<a href="javascript:void(0)" class="check_btn search_btn">검색</a>
						</div>
						<div class="adminContent_total">
							총 회원수 <span id="user_count"></span>명
						</div>
						<div style="min-height: 700px;">
							<table class="adminContent_table">
								<colgroup>
									<col width="3%">
									<col width="3%">
									<col width="8%">
									<col width="*">
									<col width="8%">
									<col width="8%">
									<col width="8%">
									<col width="8%">
									<col width="8%">
									<col width="8%">
									<col width="8%">
									<col width="8%">
								</colgroup>
								<thead>
									<th></th>
									<th>NO.</th>
									<th>이름</th>
									<th>계정</th>
									<th>ID</th>
									<th>회원유형</th>
									<th>가입일</th>
									<th>누적 구매 상품 수</th>
									<th>누적 구매 금액</th>
									<th>후기/문의</th>
									<th>가입마켓</th>
									<th>수정</th>
								</thead>
								<tbody id="user_load_tbody">
									
								</tbody>
							</table>
						</div>
						<div class="adminContent_pager" id="paging">
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>

</html>

<script>

	var users = [];
	var users_origin = [];
	var page_num = 0;

	$(document).ready(function() {

		var paging = [];

		$('.rightmenuWrap').load('admin_admin_rightmenu.html');
		
		

		user_load();

	});
	
	var now_date = Date.now();
	var enroll_time = now_date/1000;
	var user_count = 0;
	
	function load_user_list(datas){
		console.log("datas", datas);


		var new_html = ``;

		for(var i = 0; i < datas.length; i++){

			var unix_timestamp = datas[i].enroll_time;
			var date = new Date(unix_timestamp * 1000);
            var hours = date.getHours();
            var minutes = "0" + date.getMinutes();
            var seconds = "0" + date.getSeconds();
            var mon = "0" + (date.getMonth()+1);
            var day = "0" + (date.getDate());
            var formattedTime = date.getFullYear() + "-" + mon.substr(-2) + "-" + day.substr(-2);
			
			var reviewCountDict = 0;
			if(users_origin.reviewCountDict[i]){
				reviewCountDict = users_origin.reviewCountDict[i];
			}

			var inquiryCountDict = 0;
			if(users_origin.inquiryCountDict[i]){
				inquiryCountDict = users_origin.inquiryCountDict[i];
			}

			var user_type = '';
			if(datas[i].user_type == 'normal'){
				user_type = '일반회원';
			}
			new_html += `<tr>
								<td>
									<div class="adminContent_table_checkbox">
										<input id="check${datas[i].id}" type="checkbox">
										<label for="check${datas[i].id}"><span></span></label>
									</div>
								</td>
								<td>${page_num-i}</td>
								<td>`+datas[i].name+`</td>
								<td>`+datas[i].email+`</td>
								<td>`+datas[i].idStr+`</td>
								<td>${user_type}</td>
								<td>${formattedTime}</td>
								<td>0</td>
								<td>0</td>
								<td>${reviewCountDict}/${inquiryCountDict}</td>
								<td></td>
								<td>
									<div class="adminContent_order">
										<a href="javascript:void(0)" class="check_btn" onclick="">수정</a>
									</div>
								</td>
							</tr>`;
		}
		$("#user_load_tbody").html(new_html);
		$("#user_count").text(datas.length);
	}
	function user_load(){
		$.ajax({
			type : "GET",            // HTTP method type(GET, POST) 형식이다.
			url : "http://43.200.169.89/users",      // 컨트롤러에서 대기중인 URL 주소이다.
			data : {
				},            // Json 형식의 데이터이다.
			success : function(res){ // 비동기통신의 성공일경우 success콜백으로 들어옵니다. 'res'는 응답받은 데이터이다.
				// 응답코드 > 0000
				console.log(res);
				
				users = res;
				users_origin = res;

				users = users_origin['userInfoArr'].filter(function(user_info){
					return user_info.user_type == "normal";
				});
				
				$('#paging').pagination({
					dataSource: users,
					callback: function(data, pagination) {
						page_num = pagination.totalNumber - ((pagination.pageNumber-1) * pagination.pageSize);
						load_user_list(data);
					}
				})
			},
			error : function(XMLHttpRequest, textStatus, errorThrown){ // 비동기 통신이 실패할경우 error 콜백으로 들어옵니다.
				alert("통신 실패.")
			}
		});
	}
	
	$(".search_btn").click(function(e){
		var search_word = $("input[name=search_product]").val();
		
		users = users_origin['userInfoArr'].filter(function(user_info){
			return (user_info.name.indexOf(search_word) > -1 || user_info.idStr.indexOf(search_word) > -1) && user_info.user_type == "normal";
		});
		$('#paging').pagination({
			dataSource: users,
			callback: function(data, pagination) {
				page_num = pagination.totalNumber - ((pagination.pageNumber-1) * pagination.pageSize);
				load_user_list(data);
			}
		});
	})
	
	function enterkey(){
		if (window.event.keyCode == 13) {
			var search_word = $("input[name=search_product]").val();
		
			users = users_origin['userInfoArr'].filter(function(user_info){
				return (user_info.name.indexOf(search_word) > -1 || user_info.idStr.indexOf(search_word) > -1) && user_info.user_type == "normal";
			});
			$('#paging').pagination({
				dataSource: users,
				callback: function(data, pagination) {
					page_num = pagination.totalNumber - ((pagination.pageNumber-1) * pagination.pageSize);
					load_user_list(data);
				}
			});
		}
	}

</script>
