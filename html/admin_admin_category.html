<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />

	<link rel="stylesheet" type="text/css" href="../css/jquery.bxslider.css">
	<link rel="stylesheet" type="text/css" href="../css/defalut.css">
	<link rel="stylesheet" type="text/css" href="../css/admin_defalut.css">
	<link rel="stylesheet" type="text/css" href="../css/new_style.css">
	<link rel="stylesheet" type="text/css" href="../css/admin.css">
	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
	<script src="http://code.jquery.com/jquery-latest.min.js"></script>
	<script src="../js/jquery.bxslider.js"></script>
	<script src="../js/admin.js"></script>
	<link href="../js/air-datepicker/dist/css/datepicker.min.css" rel="stylesheet" type="text/css" media="all">
    <script src="../js/air-datepicker/dist/js/datepicker.js"></script> <!-- Air datepicker js -->
    <script src="../js/air-datepicker/dist/js/i18n/datepicker.ko.js"></script> <!-- 달력 한글 추가를 위해 커스텀 -->
	<script src="https://cdn.ckeditor.com/ckeditor5/34.0.0/classic/ckeditor.js"></script>
	<script src="https://cdn.ckeditor.com/ckeditor5/34.0.0/classic/translations/ko.js"></script>
	<script src="../js/pagination.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/paginationjs/2.1.4/pagination.css"/>
</head>
<body>
	<div class="container">
		<div class="header_messageLine">
			<div class="header_messageLine_message">
				<span class="message_first">
					온라인 셀러들의 도구,
				</span>
				<span class="message_second">
					헬프스토어 셀러퀸즈
				</span>
			</div>
		</div>
		<div class="admin_m_header">
			<div class="ham">
				<span></span>
				<span></span>
				<span></span>
			</div>
			<a href=""><img src="../image/admin_back.png" alt="" /></a>
			<a href="../html/main.html" class="header_gnb_logo">
				<img src="../image/logo.png">
			</a>
			<div>
				<span>김관리자</span> 님
			</div>
		</div>
		<div class="adminContainer adminadminMain">
			<!-- rightmenu -->
			<div class="rightmenuWrap"></div>
			<div class="adminWrap">
				 
				<div class="adminContent">
					 
					<div class="adminContent_right" style="background: #EAE6F2;padding: 0 20px 60px;">
						<div class="adminWrap_topmenu">
							<ul>
								<li class="active"><a href="./admin_admin_main.html">관리자 센터</a></li>
								<li><a href="./admin_seller_main.html">셀러 센터</a></li>
								<li><a href="./admin_domae_main.html">도매 센터</a></li>
								<li><a href="./admin_teacher_main.html">강사 센터</a></li>
							</ul>
						</div>
						<div class="adminWrap_title adminWrap_title_m">
							<h3>카테고리 관리</h3>
						</div> 
						<div class="cate1 modi">
							<div class="adminWrap_title2 adminWrap_title_m">
								<h3>대분류 카테고리 추가 및 선택</h3>
								<p>대분류 카테고리 제목</p>
							</div>
							<div class="adminContent_search2 adminContent_search_long2 adminContent_search_category">
								<input type="text" name="category1_value" placeholder="카테고리 제목을 입력하세요." >
								<!-- <a href="javascript:void(0)" class="check_btn onmodal">상품업로드</a> -->
								<a href="javascript:void(0)" class="check_btn2 search_btn" onclick="category_add1()">+ 추가</a>
							</div>
						</div>
						<div class="cate2 modi" style="display:none;">
							<div class="adminWrap_title2 adminWrap_title_m">
								<h3>중분류 카테고리 추가 및 선택</h3>
								<p>주요 카테고리 선택</p>
							</div>
							<div class="adminContent_search2 adminContent_search_long2 adminContent_search_category">
								<input type="text" name="category2_value" placeholder="카테고리 제목을 입력하세요." >
								<!-- <a href="javascript:void(0)" class="check_btn onmodal">상품업로드</a> -->
								<a href="javascript:void(0)" class="check_btn2 search_btn" onclick="category_add2()">+ 추가</a>
							</div>
						</div>
						<div class="cate3 modi" style="display:none;">
							<div class="adminWrap_title2 adminWrap_title_m">
								<h3>소분류 카테고리 추가 및 선택</h3>
								<p>소분류 카테고리 제목</p>
							</div>
							<div class="adminContent_search2 adminContent_search_long2 adminContent_search_category">
								<input type="text" name="category3_value" placeholder="카테고리 제목을 입력하세요." >
								<!-- <a href="javascript:void(0)" class="check_btn onmodal">상품업로드</a> -->
								<a href="javascript:void(0)" class="check_btn2 search_btn" onclick="category_add3()">+ 추가</a>
							</div>
						</div>

						<div class="adminWrap_title2 adminWrap_title_m">
							<h3>카테고리 편집</h3>
						</div>
						<div class="adminContent_drop_wrap">
							<div class="adminContent_drop">
								<!-- <div class="adminContent_drop_1depth"> 
									<div class="adminContent_drop_title">
										<h4>아동복</h4>
										<span class="adminContent_drop_modi">수정</span>
									</div>
									<div class="adminContent_drop_2depth">
										<div>
											<div class="adminContent_drop_title">
												<h5>여자아이1</h5>
												<span class="adminContent_drop_modi">수정</span>
											</div>
											<div class="adminContent_drop_3depth">
												<ul>
													<li>
														<h6>여자아이11</h6>
														<span class="adminContent_drop_modi">수정</span>
													</li>
													<li>
														<h6>여자아이22</h6>
														<span class="adminContent_drop_modi">수정</span>
													</li>
													<li>
														<h6>여자아이33</h6>
														<span class="adminContent_drop_modi">수정</span>
													</li>
												</ul>
											</div>
										</div>
									</div>
								</div> -->
							</div>
						</div>
						<div class="adminModal_cont_btn_m">
							<a href="./admin_admin_main.html" class="back_btn modalClose" style="background-color:#D3D3D3;color:white;border:none;">취소</a>
							<a href="javascript:void(0)" class="ok_btn modalClose" onclick="category_save();">저장</a>
						</div>
					</div>
				</div>
			</div>
		</div>

<script>
	$(function(){
		$('.adminContent_drop_2depth').hide();
		$('.adminContent_drop_3depth').hide();
		$('.adminContent_drop_title').click(function(){
			$(this).siblings('div').slideToggle();
			$(this).toggleClass('drop_toggle_on');
		});
		$('.adminContent_drop_modi').click(function(){
			//alert('오잉');
		});
	});
	$(window).on('load', function () {
		
	})
</script>
		



	<div id="modal2" class="adminModal modal-overlay" style="display: none;">
		<div class="adminModal_ok adminModal_invoice" style="width:80%;">
			<h3>카테고리 편집</h3>
			<div>
				<div>
					<input type="text" name="category_name" placeholder="">
				</div>
			</div>
			<div class="adminModal_ok_btn">
				<a href="javascript:void(0)" class="ok_btn_cate del_btn" style="background-color:gray;">삭제</a>
				<a href="javascript:void(0)" class="ok_btn_cate modalClose" >취소</a>
				<a href="javascript:void(0)" class="ok_btn_cate modi_btn" >수정</a>
			</div>
		</div>
	</div>
</body>

</html>

<script>
	var productInfoDict = [];
	var products = [];
	var products_origin = [];

	var category1_arr = [];
	
	var page_num = 0;

	$(document).ready(function() {
		
		category_load();


		$('.rightmenuWrap').load('admin_admin_rightmenu.html');

		$('.adminModal').hide();
		//$('.adminModal a').attr('href','javascript:void(0)');
		$('.onmodal').click(function(){
			$('.modalPage01').show();
		});
		$('.adminModal_cont_plusbtn').click(function(){
			$('.modalPage01').hide();
			$('.modalPage02').show();
		});
		$('.modalNext1').click(function(){
			//$('.modalPage01').hide();
			//$('.modalPage03').show();
		});
		$('.modalNext1-1').click(function(){
			//$('.modalPage02').hide();
			//$('.modalPage01').show();
		});
		$('.modalNext2').click(function(){
			$('.modalPage03').hide();
			$('.modalPage04').show();
		});
		$('.modalClose').click(function(){
			$('#modal2').hide();
		});
		$('.adminModal_category_btn a').click(function(){
			$(this).addClass('on');
			$(this).siblings().removeClass('on');
			$('.adminModal_category_plus').show();
		});
		$('.plusnone').click(function(){
			//$('.adminModal_category_plus').hide();
		});
		$('.adminContent_leftmenu_modify').click(function(){
			$('.admincategory').show();
		});

	});

	$(window).load(function(){
		$(".right_menu_2_1").addClass('active');


		$('.adminContent_drop_2depth').hide();
		$('.adminContent_drop_3depth').hide();
		//$('.adminContent_drop_title > h4').click(function(){
		$(document).on('click','.adminContent_drop_title > h4',function(){
			$(this).parent().siblings('div').slideToggle();
			$(this).parent().toggleClass('drop_toggle_on');

			$(this).parent().parent().siblings().find(".adminContent_drop_2depth").slideUp();
			$(this).parent().parent().siblings().find('.adminContent_drop_title').removeClass('drop_toggle_on');

			$(this).parent().parent().siblings('.adminContent_drop_1depth').find('.adminContent_drop_2depth').find('.adminContent_drop_3depth').slideUp();
			$(this).parent().parent().siblings('.adminContent_drop_1depth').find('.adminContent_drop_2depth').children().removeClass('drop_toggle_on');
			
			if($(this).parent().hasClass("drop_toggle_on")){
				$(".cate1").hide();
				$(".cate2").show();
				$(".cate3").hide();
			}else{
				$(".cate1").show();
				$(".cate2").hide();
				$(".cate3").hide();
			}
			//$(".cate2").show();
			//$(".cate2").siblings('.modi').hide();

		});
		//$('.adminContent_drop_title > h5').click(function(){
		$(document).on('click','.adminContent_drop_title > h5',function(){
			$(this).parent().siblings('div').slideToggle();
			$(this).parent().parent().toggleClass('drop_toggle_on').toggleClass('drop_toggle_on2');
			
			$(this).parent().parent().parent().siblings('.adminContent_drop_2depth').find('.adminContent_drop_3depth').slideUp();
			$(this).parent().parent().parent().siblings('.adminContent_drop_2depth').children().removeClass('drop_toggle_on');
			$(this).parent().parent().parent().siblings('.adminContent_drop_2depth').children().removeClass('drop_toggle_on2');
			
			if($(this).parent().parent().hasClass("drop_toggle_on")){
				$(".cate1").hide();
				$(".cate2").hide();
				$(".cate3").show();
			}else{
				$(".cate1").hide();
				$(".cate2").show();
				$(".cate3").hide();
			}

		});
		
		$(document).on('click','.adminContent_drop_modi',function(){
			$(this).toggleClass('modi_on');
			$('#modal2').show();
			$("input[name=category_name]").val($(this).prev().text());
		});
		
		$(document).on('click','.modi_btn',function(){
			$(".modi_on").prev().text($("input[name=category_name]").val());
			$(".modi_on").removeClass("modi_on");
			$('#modal2').hide();
		});

		$(document).on('click','.del_btn',function(){

			if($(".modi_on").hasClass("modi_cate1")){
				$(".modi_on.modi_cate1").closest(".adminContent_drop_1depth").remove();
			}
			if($(".modi_on").hasClass("modi_cate2")){
				$(".modi_on.modi_cate2").closest(".adminContent_drop_2depth").remove();
			}
			if($(".modi_on").hasClass("modi_cate3")){
				$(".modi_on.modi_cate3").closest(".adminContent_drop_3depth").remove();
			}
			
			$(".modi_on").removeClass("modi_on");
			$('#modal2').hide();

		});

		
		
	})
	const modal = document.getElementById("modal2")
	const closeBtn = modal.querySelector(".close-area")
	const close_btn = modal.querySelector("#close_btn")

	//close_btn.addEventListener("click", e => {
	//	modal.style.display = "none"
	//})

	//closeBtn.addEventListener("click", e => {
	//	modal.style.display = "none"
	//})

	modal.addEventListener("click", e => {
		const evTarget = e.target
		if(evTarget.classList.contains("modal-overlay")) {
			modal.style.display = "none"
			$(".modi_on").removeClass("modi_on");
		}
	})

	window.addEventListener("keyup", e => {
		if(modal.style.display === "flex" && e.key === "Escape") {
			modal.style.display = "none"
		}
	})

	var parent_id = 0;
	var checked_type = 0;

	$("body").on("change","input[type=checkbox][name='category_chkbox']", function(e){
		console.log(e.target);
		if($(e.target).closest("input[type=checkbox][name='category_chkbox']").prop('checked')){
			$('input[type="checkbox"][name="category_chkbox"]').prop('checked',false);
			$(e.target).prop('checked',true);
			
			$(e.target).siblings("input[type=text]").show();
			//console.log($(e.target).siblings("input[name=category_text]"));
			//$(e.target).siblings("input[name=category_text]").val('');
			$(e.target).siblings("label").text('수정 : ');
			$(e.target).siblings("label").append('<span>');
			$(e.target).siblings("input[name=category_text]").addClass('category_text');

			var category_num = $(e.target).data('type');

			if(category_num=='category1'){
				checked_type = 1;
				$("select[name=category_select]").val('category2');
			}else if(category_num=='category2'){
				checked_type = 2;
				$("select[name=category_select]").val('category3');
			}else if(category_num=='category3'){
				checked_type = 3;
				$("select[name=category_select]").val('');
			}
		}else{ // 체크 풀릴때
			checked_type = 0;
			$("select[name=category_select]").val('category1');
			$(e.target).siblings("input[type=text]").hide();
			$(e.target).siblings("label").append('<span>');
			$(e.target).siblings("label").text($(e.target).siblings("input[name=category_text]").val());
			$(e.target).siblings("input[name=category_text]").removeClass('category_text');
		}
	
	});
	var now_date = Date.now();
	var enroll_time = now_date/1000;


	function category_save(){
		var eles = $(".adminContent_drop_1depth");

		var category1Arr = [];
		$.each(eles,function(n,e){
		 var cate1_eles = $(e).children().children("h4");
			 $.each(cate1_eles,function(m,c1){
			   var cate1Dict = {};
				 var category_name = $(c1).text();
				 //console.log('category_name',category_name);
				 cate1Dict['typeStr']='category1';
				 cate1Dict['category_name'] = category_name;
				 
				 var category2Arr = [];
				 var cate2_eles = $(c1).parent().siblings(".adminContent_drop_2depth");
				 $.each(cate2_eles,function(a,c2){
				   var cate2Dict = {};
				   var category_name = $(c2).children().children().children("h5").text();
				 
					 cate2Dict['typeStr']='category2';
					 cate2Dict['category_name'] = category_name;
					 
					 var category3Arr = [];
					 var cate3_eles = $(c2).find(".adminContent_drop_3depth").children().children();
					 $.each(cate3_eles,function(b,c3){
							 var cate3Dict = {};
						   var category_name = $(c3).children("h6").text();
						 
							 cate3Dict['typeStr']='category3';
							 cate3Dict['category_name'] = category_name;
							 category3Arr.push(cate3Dict);
					 });
					 
					 cate2Dict['children'] = category3Arr;
					 
					 category2Arr.push(cate2Dict);
				 });
				 
				 cate1Dict['children'] = category2Arr;
				 category1Arr.push(cate1Dict);
			 })
		});

		console.log('**category1Arr',category1Arr);
		
		var category_string = JSON.stringify(category1Arr);
		//console.log('category_string', category_string);
		return;
		$.post("http://43.200.169.89/update-categories",{
			categories : category_string
		},result=>{
			if(result == "success"){
			alert('카테고리가 수정되었습니다.');
			}
		})
	}
	
	function category_load(){
		$.ajax({
			type : "GET",            // HTTP method type(GET, POST) 형식이다.
			url : "http://43.200.169.89/categories",      // 컨트롤러에서 대기중인 URL 주소이다.
			async : false,
			data : {
				},            // Json 형식의 데이터이다.
			success : function(datas){ // 비동기통신의 성공일경우 success콜백으로 들어옵니다. 'res'는 응답받은 데이터이다.
				//console.log(datas);
				var cate = JSON.parse(datas['categories']);
				console.log("cate",cate);

				var tag = ``;
				var tag2 = ``;
				var tag3 = ``;

				for(var i = 0; i < cate.length; i++){
					if(cate[i].children.length != 0){
						for(var j = 0; j < cate[i].children.length; j++){
							if(cate[i].children[j].children.length != 0){
								for(var k = 0; k < cate[i].children[j].children.length; k++){
									tag3 += `<li>
													<h6>${cate[i].children[j].children[k].category_name}</h6>
													<span class="adminContent_drop_modi modi_cate3">수정</span>
												</li>`;
								}
								
							}else{
								tag3 = ``;
							}
							tag2 += `<div class="adminContent_drop_2depth">
										<div>
											<div class="adminContent_drop_title">
												<h5>${cate[i].children[j].category_name}</h5>
												<span class="adminContent_drop_modi modi_cate2">수정</span>
											</div>
											<div class="adminContent_drop_3depth">
												<ul>
											${tag3}
												</ul>
											</div>
										</div>
									</div> `;

							tag3 = ``;//초기화
						}
						
					}else{
						tag2 = ``;
					}
					

					tag += `<div class="adminContent_drop_1depth"> 
									<div class="adminContent_drop_title">
										<h4>${cate[i].category_name}</h4>
										<span class="adminContent_drop_modi modi_cate1">수정</span>
									</div>
									${tag2}
								</div>`;

					tag2 = ``; // 초기화
					

				}
				
				$(".adminContent_drop").append(tag);
				

			},
			error : function(XMLHttpRequest, textStatus, errorThrown){ // 비동기 통신이 실패할경우 error 콜백으로 들어옵니다.
				alert("통신 실패.")
			}
		});
	}


	function category_add1(){
		var category1_value = $("input[name=category1_value]").val();

		if(category1_value == ""){
			alert("카테고리 제목을 입력하세요.");
			return;
		}

		var tag = ``;

		tag += `<div class="adminContent_drop_1depth"> 
						<div class="adminContent_drop_title">
							<h4>${category1_value}</h4>
							<span class="adminContent_drop_modi modi_cate1">수정</span>
						</div>
						
					</div>`;

		$(".adminContent_drop").prepend(tag);
		//$(".category_section").find("input[name=category_text]")[0].focus();
	
		
	}

	function category_add2(){

		var category2_value = $("input[name=category2_value]").val();

		if(category2_value == ""){
			alert("카테고리 제목을 입력하세요.");
			return;
		}

		var tag = ``;

		tag += `<div class="adminContent_drop_2depth">
										<div>
											<div class="adminContent_drop_title">
												<h5>${category2_value}</h5>
												<span class="adminContent_drop_modi modi_cate2">수정</span>
											</div>
											<div class="adminContent_drop_3depth">
												<ul>
											
												</ul>
											</div>
										</div>
									</div>`;
		$(".drop_toggle_on").after(tag);
		
		//$( "input[name='category_chkbox']:checked" ).parent().parent().find('.bottom_list').find("input[name=category_text]")[0].focus();


	}

	function category_add3(){

		var category3_value = $("input[name=category3_value]").val();

		if(category3_value == ""){
			alert("카테고리 제목을 입력하세요.");
			return;
		}

		var tag = ``;
		
		tag += `<li>
						<h6>${category3_value}</h6>
						<span class="adminContent_drop_modi modi_cate3">수정</span>
					</li>`;
		$(".drop_toggle_on2").find(".adminContent_drop_3depth > ul").append(tag);
        $(".drop_toggle_on2").find(".adminContent_drop_3depth").show();
		//$( "input[name='category_chkbox']:checked" ).parent().parent().find('.bottom_list').find("input[name=category_text]")[0].focus();
	}
	
	function category_modify(){
		
	}
	
	function category_delete(){
		
		$("input:checkbox[name='category_chkbox']:checked").parent().parent().remove();
		
		
		$("body").on("change","input[type=checkbox][name='category_chkbox']", function(e){
			if($(e.target).closest("input[type=checkbox][name='category_chkbox']").prop('checked')){
				$(e.target).parent().parent().addClass('test');
			}else{ // 체크 풀릴때
				checked_type = 0;
				$("select[name=category_select]").val('category1');
			}
		
		});
	}
	
</script>
