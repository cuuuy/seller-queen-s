<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
	<link rel="stylesheet" type="text/css" href="../css/jquery.bxslider.css">
	<link rel="stylesheet" type="text/css" href="../css/defalut.css">
	<link rel="stylesheet" type="text/css" href="../css/admin_defalut.css">
	<link rel="stylesheet" type="text/css" href="../css/new_style.css">
	<link rel="stylesheet" type="text/css" href="../css/admin.css">
	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
	<script src="http://code.jquery.com/jquery-latest.min.js"></script>
	<script src="../js/jquery.bxslider.js"></script>
	<script src="../js/admin.js"></script>
	<script src="../js/function.js"></script>
    <script src="../js/pagination.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/paginationjs/2.1.4/pagination.css"/>
</head>
<body>
	<div class="container">
		<div class="header_messageLine">
			<div class="header_messageLine_message">
				<span class="message_first">
					온라인 셀러들의 도구,
				</span>
				<span class="message_second">
					헬프스토어 셀러퀸즈
				</span>
			</div>
		</div>
		<div class="admin_m_header">
			<div class="ham">
				<span></span>
				<span></span>
				<span></span>
			</div>
			<a href=""><img src="../image/admin_back.png" alt="" /></a>
			<a href="../html/main.html" class="header_gnb_logo">
				<img src="../image/logo.png">
			</a>
			<div>
				<span>김관리자</span> 님
			</div>
		</div>
		<div class="adminContainer">
			<!-- rightmenu -->
			<div class="rightmenuWrap"></div>
			<div class="adminWrap">
				 <div class="adminWrap_topmenu">
					<ul>
						<li class="active"><a href="./admin_admin_main.html">관리자 센터</a></li>
						<li><a href="./admin_seller_main.html">셀러 센터</a></li>
						<li><a href="./admin_domae_main.html">도매 센터</a></li>
						<li><a href="./admin_teacher_main.html">강사 센터</a></li>
					</ul>
				</div>
				<div class="adminWrap_title">
					<a href="./admin_admin_main.html"><img src="../image/admin_back.png" alt="" /></a>
					<h3>프로핏</h3>
				</div> 
					<div class="adminContent">
						<div class="adminContent_tab adminContent_tab6">
							<ul>
								<li class="active"><a href="./admin_admin_profit_01.html" class="title_middle_m">회원 리스트</a></li>
								<li><a href="./admin_admin_profit_02.html" class="title_middle_m">출금신청 리스트</a></li>
								<!-- <li><a href="./admin_admin_profit_03.html">판매수수료 리스트</a></li> -->
								<li><a href="./admin_admin_profit_04.html" class="title_middle_m">판매수수료 적립현황</a></li>
								<li><a href="./admin_admin_profit_05.html" class="title_middle_m">광고수수료 적립현황</a></li>
								<li><a href="./admin_admin_profit_06.html" class="title_middle_m">판매수수료 출금 현황</a></li>
								<li><a href="./admin_admin_profit_07.html" class="title_middle_m">광고수수료 출금 현황</a></li>
							</ul>
						</div>
						<!-- <div class="adminContent_profit">
							89,000원
						</div> -->
						<div class="adminContent_search adminContent_search6">
							<input type="search" name="search_profit" class="search_profit" placeholder="상품을 검색하세요." style="width: calc( 100% - 400px );" onkeyup="enterkey()">
							<!-- <select class="check_btn adminContent_search_select">
								<option>판매 프로핏</option>
							</select> -->
							<a href="javascript:void(0)" class="check_btn search_btn">검색</a>
						</div>
						<div class="adminContent_date adminContent_date6">
							<select name="search_year1">
							</select>
							<select  name="search_month1">
							</select>
							<select  name="search_day1">
							</select>
						</div>
						<div class="adminContent_date_middle">
							<b>────</b>
						</div>
						<div class="adminContent_date adminContent_date6">
							<select name="search_year2">
							</select>
							<select  name="search_month2">
							</select>
							<select  name="search_day2">
							</select>
						</div>
						<div class="adminContent_date2 adminContent_date_hidden">
							<select>
								<option>회원등급</option>
							</select>
						</div>

						<div class="adminContent_date2 adminContent_date_hidden">
							<select>
								<option>정산상태</option>
							</select>
						</div>
						<!-- <div class="adminContent_order">
							<a href="" class="check_btn">지급하기</a>
							<a href="" class="check_btn">회수하기</a>
						</div> -->
						<div>
							<table class="adminContent_table">
								<colgroup>
									<col width="3%">
									<col width="3%">
									<col width="*">
									<col width="10%">
									<col width="10%">
									<col width="10%">
									<col width="10%">
									<col width="8%">
									<col width="8%">
								</colgroup>
								<thead>
									<th></th>
									<th>No.</th>
									<th>계정</th>
									<th>ID</th>
									<th>회원유형</th>
									<th>닉네임</th>
									<th>가입일</th>
									<th>판매 프로핏 금액</th>
									<th>광고 프로핏 금액</th>
								</thead>
								<tbody id="withdraw_tbody">
									<tr>
										<td>
											<div class="adminContent_table_checkbox">
												<input id="check02" type="checkbox">
												<label for="check02"><span></span></label>
											</div>
										</td>
										<td>1</td>
										<td class="adminContent_table_name">
											<p>adcd@hamil.com</p>
										</td>
										<td>tjdwldkdlel</td>
										<td>J 등급</td>
										<td>레몬트리</td>
										<td>20220401</td>
										<td>2,000,000</td>
										<td>2,000,000</td>
									</tr>
								</tbody>
							</table>
						</div>
						<div class="adminContent_pager" id="paging">
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>

</html>

<script>
	$(document).ready(function() {
		$('.rightmenuWrap').load('admin_admin_rightmenu.html');
	});

    var users = [];
	var users_origin = [];
	var user_id = localStorage.getItem('user_id');
    var profit_id_arr = [];
    var total_profit = 0;
    var profitInfoDict = [];

    var page_num = 0;

    function load_user_list(datas){
		//console.log('datas',datas);
		var tag = ``;
        var i = 0;
		$.each(datas, function(m, user){
			total_profit = total_profit + user.withdraw_amount;
			var unix_timestamp = user.enroll_time;
			var date = new Date(unix_timestamp * 1000);
            var hours = date.getHours();
            var minutes = "0" + date.getMinutes();
            var seconds = "0" + date.getSeconds();
            var mon = "0" + (date.getMonth()+1);
            var day = "0" + (date.getDate());
            var formattedTime = date.getFullYear() + "-" + mon.substr(-2) + "-" + day.substr(-2);
			
			var stateStr = '';
			if(user.stateStr=="requested"){
				stateStr = "출금요청중";
			}else if(user.stateStr=="confirmed"){
                stateStr = "지급완료";
            }
			
			var bank_name = '';
			if(user.bank == 'sinhan'){
				bank_name = '신한';
			}else{
				bank_name = user.bank;
			}

            var profitInfoDictResult = 0;
			if(profitInfoDict[datas[i].id]){
				profitInfoDictResult_retail = profitInfoDict[datas[i].id].retailer_profit;
                profitInfoDictResult_manager = profitInfoDict[datas[i].id].manager_profit;
			}else{
				profitInfoDictResult_retail = 0;
                profitInfoDictResult_manager = 0;
			}

			 tag += `<tr>
                        <td>
                            <div class="adminContent_table_checkbox">
                                <input id="check${user.id}" type="checkbox">
                                <label for="check${user.id}"><span></span></label>
                            </div>
                        </td>
                        <td>${page_num-i}</td>
                        <td class="adminContent_table_name">
                            <p>${user.email}</p>
                        </td>
                        <td>${user.idStr}</td>
                        <td>${user.user_type}</td>
                        <td>${user.nickname}</td>
                        <td>${formattedTime}</td>
                        <td>${parseInt(profitInfoDictResult_retail).toLocaleString('ko-KR')}</td>
                        <td>${parseInt(profitInfoDictResult_manager).toLocaleString('ko-KR')}</td>
                    </tr>`;
            i++;
		})

        $(".total_profit").text(total_profit.toLocaleString('ko-KR'));
		$("#withdraw_tbody").html(tag);

	}

	$.get("http://43.200.169.89/sellers",result=>{
		console.log(result);

		users = result;
		users_origin = result['users'];
		
        profitInfoDict = result['profitInfoDict'];

		var time_arr = [];
		$.each(users_origin, function(i, res){
			time_arr.push(res.enroll_time);
		});

		var date2 = new Date(Math.max.apply(null, time_arr) * 1000);
		var mon2 = date2.getMonth()+1;
		var day2 = date2.getDate();

		var date3 = new Date(Math.min.apply(null, time_arr) * 1000);
		var mon3 = date3.getMonth()+1;
		var day3 = date3.getDate();

		$("select[name=search_year1]").val(date3.getFullYear()).prop("selected",true);
		$("select[name=search_month1]").val(mon3).prop("selected",true);
		$("select[name=search_day1]").val(day3).prop("selected",true);
		
		$("select[name=search_year2]").val(date2.getFullYear()).prop("selected",true);
		$("select[name=search_month2]").val(mon2).prop("selected",true);
		$("select[name=search_day2]").val(day2).prop("selected",true);

		$('#paging').pagination({
			dataSource: users_origin,
			callback: function(data, pagination) {
                page_num = pagination.totalNumber - ((pagination.pageNumber-1) * pagination.pageSize);
				load_user_list(data);
			}
		});
		
	});
</script>
