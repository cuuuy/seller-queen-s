<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<link rel="stylesheet" type="text/css" href="../css/jquery.bxslider.css">
	<link rel="stylesheet" type="text/css" href="../css/defalut.css">
	<link rel="stylesheet" type="text/css" href="../css/style.css">
	<link rel="stylesheet" type="text/css" href="../css/new_style.css">
    <link rel="stylesheet" type="text/css" href="../css/market_style.css">
	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
	<script src="http://code.jquery.com/jquery-latest.min.js"></script>
	<script src="../js/jquery.bxslider.js"></script>
	<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
</head>

<body class="join_body">
	<div class="container">
		<div class="header"></div>
		<div class="join">
			<ul id="join_tab">
				<li>
					<span>1</span>
					안내
				</li>
				<li>
					<span>2</span>
					약관 및 동의
				</li>
				<li class="active">
					<span>3</span>
					정보입력
				</li>
				<li>
					<span>4</span>
					회원가입신청
				</li>
				<li>
					<span>5</span>
					결제하기
				</li>
				<li>
					<span>6</span>
					신청 완료
				</li>
			</ul>
			<div class="join_page">
				<a href="join_page03.html" id="join_page_prev">
					<img src="../image/join_arrow_prev.png" alt="">
				</a>
				<div class="join_page_04">
					<h5 class="user_type"></h5>
					<table class="join_form">
						<colgroup>
							<col width="16.8%">
							<col width="*">
							<col width="13%">
						</colgroup>
						<tbody>
							<tr>
								<th>이메일</th>
								<td>
									<input type="text" id="email" placeholder="이메일 주소를 입력해주세요.">
								</td>
								<td><a href="javascript:void(0)" onclick="emil_check()">중복확인</a></td>
							</tr>
							<tr>
								<th>아이디</th>
								<td>
									<input type="text" id="id" placeholder="아이디를 입력해주세요.">
								</td>
								<td><a href="javascript:void(0)" onclick="id_check()">중복확인</a></td>
							</tr>
							<tr>
								<th>비밀번호</th>
								<td colspan="2">
									<input type="password" id="pw" placeholder="영문,숫자 조합 8~12자리 이내로 입력해주세요.">
								</td>
							</tr>
							<tr>
								<th>비밀번호 확인</th>
								<td colspan="2">
									<input type="password" id="pw2" placeholder="비밀번호를 한 번 더 입력해주세요.">
								</td>
							</tr>
							<tr>
								<th>이름</th>
								<td colspan="2">
									<input type="text" id="name" placeholder="이름을 입력해주세요.">
								</td>
							</tr>
							<tr id="nickname_tr">
								<th rowspan="2">닉네임</th>
								<td>
									<input type="text" id="nickname" placeholder="닉네임을 입력해주세요.">
								</td>
								<td><a href="javascript:void(0)" onclick="nickname_check()">중복확인</a></td>
							</tr>
							<tr id="nickname_tr2">
								<td colspan="2" class="text">* 닉네임은 최초 입력 후 1회 변경만 가능합니다. 닉네임은 셀러 마켓 메인으로 표시 됩니다.</td>
							</tr>
							<tr>
								<th>생년월일</th>
								<td colspan="2">
									<select name="birth_time1" id="birth_time1">
									</select>
									<select name="birth_time2" id="birth_time2">
									</select>
									<select name="birth_time3" id="birth_time3">
									</select>
								</td>
							</tr>
							<tr>
								<th rowspan="2">주소</th>
								<td>
									<input type="text" id="member_addr" placeholder="주소를 입력해주세요.">
								</td>
								<td><a href="javascript:void(0)" onclick="findAddr()">주소검색</a></td>
							</tr>
							<tr>
								<td colspan="2">
									<input type="text" id="member_addr2" placeholder="상세주소를 입력해주세요.">
								</td>
							</tr>
							<tr>
								<th>연락처</th>
								<td>
									<input type="text" placeholder="+82(한국)" class="w30" id="phone_nation">
									<input type="text" placeholder="전화번호를 입력해주세요." class="w70" id="phone">
								</td>
								<td><a href="javascript:alert('인증번호가 전송되었습니다.');">인증번호 전송</a></td>
							</tr>
							<tr>
								<th>인증번호</th>
								<td>
									<input type="text" placeholder="인증번호를 입력해주세요.">
								</td>
								<td><a href="javascript:alert('인증되었습니다.')">확인</a></td>
							</tr>
							<tr id="recommend1">
								<th>추천인 연락처</th>
								<td colspan="2">
									<input type="text" placeholder="+82(한국)" class="w30" id="recommender_phone_nation">
									<input type="text" placeholder="전화번호를 입력해주세요." class="w70" id="recommender_phone">
								</td>
								<td></td>
							</tr>
							<tr id="recommend2">
								<th>추천인 이름</th>
								<td colspan="2">
									<input type="text" placeholder="추천인 이름을 입력해주세요." id="recommender_name">
								</td>
								<td></td>
							</tr>
						</tbody>
					</table>
					<!-- <a href="join_page05.html" class="ok_btn">회원가입 신청</a> -->
					<a href="javascript:void(0)" onclick="join_submit()" class="ok_btn">회원가입 신청</a>
				</div>
				<a href="javascript:void(0);" id="join_page_next">
					<img src="../image/join_arrow_next.png" alt="">
				</a>
			</div>
		</div>
		<div class="footer"></div>
	</div>
    <div class="marketContainer">
		<div class="header">
			<header class="marketHeader marketMemberHeader">
			<div>
				<a href="./join_page02.html"><img src="../image/market_back.png" alt=""></a>
			</div>
			<h2>정보 입력</h2>
		    </header>
        </div>
		<div class="join">
			<div class="join_page">
				<div class="join_page_04" style="background-color: #F4F2F8;">
					<h5 class="user_type"></h5>
					<table class="join_form">
						<colgroup>
							<col width="*">
                            <col width="3%">
						</colgroup>
						<tbody>
                            <tr>
								<th>이메일<span style="margin-left: 2px;color: #5A3E86;">*이메일 형식을 확인해주세요.</span></th>
							</tr>
							<tr>
								<td colspan="2">
									<input type="text" id="email" placeholder="이메일 주소를 입력해주세요.">
								</td>
								<td><a href="javascript:void(0)" onclick="emil_check()">중복확인</a></td>
							</tr>
                            <tr>
								<th>아이디</th>
							</tr>
							<tr>
								<td colspan="2">
									<input type="text" id="id" placeholder="아이디를 입력해주세요.">
								</td>
								<td><a href="javascript:void(0)" onclick="id_check()">중복확인</a></td>
							</tr>
                            <tr>
								<th>비밀번호</th>
							</tr>
							<tr>
								<td colspan="3">
									<input type="password" id="pw" placeholder="영문,숫자 조합 8~12자리 이내로 입력해주세요.">
								</td>
							</tr>
                            <tr>
								<th>비밀번호 확인</th>
							</tr>
							<tr>
								<td colspan="3">
									<input type="password" id="pw2" placeholder="비밀번호를 한 번 더 입력해주세요.">
								</td>
							</tr>
                            <tr>
								<th>이름</th>
							</tr>
							<tr>
								<td colspan="3">
									<input type="text" id="name" placeholder="이름을 입력해주세요.">
								</td>
							</tr>
                            <tr id="nickname_tr3">
								<th>닉네임</th>
							</tr>
							<tr id="nickname_tr">
								<td colspan="2">
									<input type="text" id="nickname" placeholder="닉네임을 입력해주세요.">
								</td>
								<td><a href="javascript:void(0)" onclick="nickname_check()">중복확인</a></td>
							</tr>
							<tr id="nickname_tr2">
								<td colspan="3" class="text">* 닉네임은 최초 입력 후 1회 변경만 가능합니다. 닉네임은 셀러 마켓 메인으로 표시 됩니다.</td>
							</tr>
                            <tr>
								<th>생년월일</th>
							</tr>
							<tr>
								<td colspan="3">
									<select name="birth_time1" id="birth_time1">
									</select>
									<select name="birth_time2" id="birth_time2">
									</select>
									<select name="birth_time3" id="birth_time3">
									</select>
								</td>
							</tr>
                            <tr>
								<th>주소</th>
							</tr>
							<tr>
								<td colspan="2">
									<input type="text" id="member_addr" placeholder="주소를 입력해주세요.">
								</td>
								<td><a href="javascript:void(0)" onclick="findAddr()">주소검색</a></td>
							</tr>
							<tr>
								<td colspan="3">
									<input type="text" id="member_addr2" placeholder="상세주소를 입력해주세요.">
								</td>
							</tr>
                            <tr>
								<th>연락처</th>
							</tr>
							<tr>
								<td colspan="3">
									<input type="text" placeholder="+82(한국)" class="" id="phone_nation" style="width: 30%;">
									<input type="text" placeholder="전화번호를 입력해주세요." class="" id="phone" style="width: 68%;">
								</td>
								
							</tr>
                            <tr>
								<th>인증번호</th>
							</tr>
							<tr>
								<td colspan="2">
									<input type="text" placeholder="인증번호를 입력해주세요.">
								</td>
                                <td><a href="javascript:alert('인증번호가 전송되었습니다.');">인증번호 전송</a></td>
								<!-- <td><a href="javascript:alert('인증되었습니다.')">확인</a></td> -->
							</tr>
                            <tr id="recommend4">
								<th>추천인 연락처</th>
							</tr>
							<tr id="recommend1">
								<td colspan="3">
									<input type="text" placeholder="+82(한국)" class="" id="recommender_phone_nation" style="width: 30%;">
									<input type="text" placeholder="전화번호를 입력해주세요." class="" id="recommender_phone" style="width: 68%;">
								</td>
							</tr>
                            <tr id="recommend3">
								<th>추천인 이름</th>
							</tr>
							<tr id="recommend2">
								<td colspan="3">
									<input type="text" placeholder="추천인 이름을 입력해주세요." id="recommender_name">
								</td>
							</tr>
						</tbody>
					</table>
					<!-- <a href="join_page05.html" class="ok_btn">회원가입 신청</a> -->
					<a href="javascript:void(0)" onclick="join_submit()" class="ok_btn">회원가입 신청</a>
				</div>
			</div>
		</div>
		<div class="footer"></div>
	</div>
</body>


<script>
	function Mobile(){
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);}
	
    if (Mobile()){// 모바일일 경우
        $(".marketContainer").show();
        $(".container").remove();
    } else {// 모바일 외
        $(".marketContainer").remove();
        $(".container").show();
        $('.header').load('head.html');
		$('.footer').load('footer.html');
    }
	var queryString = window.location.search;
	var urlParams = new URLSearchParams(queryString);
	var user_type = urlParams.get('user_type');
	var seller_type = urlParams.get('seller_type');

	$(document).ready(function() {
		
		$('.pra_drop').click(function(){
			$('.join_page_03_privacy > p').css('height','auto');
		});

		var user_type_string = "";
		if(user_type=="seller"){
			user_type_string = "셀러";
		}else if(user_type=="wholesaler"){
			user_type_string = "도매";
			$("#recommend1").hide();
			$("#recommend2").hide();
            $("#recommend3").hide();
			$("#recommend4").hide();
		}else if(user_type=="teacher"){
			user_type_string = "강사";
			$("#recommend1").hide();
			$("#recommend2").hide();
            $("#recommend3").hide();
			$("#recommend4").hide();
			$("#nickname_tr").hide();
			$("#nickname_tr2").hide();
            $("#nickname_tr3").hide();
		}
		$(".user_type").text(user_type_string);

		var option1 = ``;
		for(var i = 1950; i <= 2020; i++){
			option1 += `<option value="${i}">${i}</option>`;
		}

		var option2 = ``;
		for(var i = 1; i <= 12; i++){
			option2 += `<option value="${i}">${i}</option>`;
		}

		var option3 = ``;
		for(var i = 1; i <= 31; i++){
			option3 += `<option value="${i}">${i}</option>`;
		}

		$("#birth_time1").append(option1);
		$("#birth_time2").append(option2);
		$("#birth_time3").append(option3);
	});
	
	

	function findAddr(){
		new daum.Postcode({
			oncomplete: function(data) {
				
				console.log(data);
				
				var roadAddr = data.roadAddress; // 도로명 주소 변수
				var jibunAddr = data.jibunAddress; // 지번 주소 변수

				if(roadAddr !== ''){
					document.getElementById("member_addr").value = roadAddr;
				} 
				else if(jibunAddr !== ''){
					document.getElementById("member_addr").value = jibunAddr;
				}
			}
		}).open();
	}

	function emil_check(){
		var email = $("#email").val();
		
		if(email==""){
			alert("이메일을 입력해주세요.");
			return false;
		}

        function fn_emailChk(email){
            var regExp = /\w+([-+.]\w+)*@\w+([-.]\w+)*\.[a-zA-Z]{2,4}$/;
            if(!regExp.test(email)){
                return false;
            }
            return true;
        }

        if(!fn_emailChk(email)){
            alert('이메일 형식이 옳바르지 않습니다.');
            return false;
        }

		$.ajax({
			type : "POST",            // HTTP method type(GET, POST) 형식이다.
			url : "http://43.200.169.89/check-email",      // 컨트롤러에서 대기중인 URL 주소이다.
			data : {
				email : email
				},            // Json 형식의 데이터이다.
			success : function(res){ // 비동기통신의 성공일경우 success콜백으로 들어옵니다. 'res'는 응답받은 데이터이다.
				//alert(res);

				if(res == "can make"){
					alert("등록가능한 이메일 입니다.");
				}else if(res == "already exist"){
					alert("이미 존재하는 이메일 입니다. 다른 이메일을 사용해 주세요.");
				}
			},
			error : function(XMLHttpRequest, textStatus, errorThrown){ // 비동기 통신이 실패할경우 error 콜백으로 들어옵니다.
				alert("통신 실패.")
			}
		});
	}

	function id_check(){
		var id = $("#id").val();
		if(id==""){
			alert("아이디를 입력해주세요.");
			return false;
		}

		$.ajax({
			type : "POST",            // HTTP method type(GET, POST) 형식이다.
			url : "http://43.200.169.89/check-idStr",      // 컨트롤러에서 대기중인 URL 주소이다.
			data : {
				idStr : id
				},            // Json 형식의 데이터이다.
			success : function(res){ // 비동기통신의 성공일경우 success콜백으로 들어옵니다. 'res'는 응답받은 데이터이다.
				//alert(res);

				if(res == "can make"){
					alert("등록가능한 아이디 입니다.");
				}else if(res == "already exist"){
					alert("이미 존재하는 아이디 입니다. 다른 아이디를 사용해 주세요.");
				}
			},
			error : function(XMLHttpRequest, textStatus, errorThrown){ // 비동기 통신이 실패할경우 error 콜백으로 들어옵니다.
				alert("통신 실패.")
			}
		});
	}

    function nickname_check(){
		var nickname = $("#nickname").val();
		if(nickname==""){
			alert("닉네임을 입력해주세요.");
			return false;
		}

		$.ajax({
			type : "POST",            // HTTP method type(GET, POST) 형식이다.
			url : "http://43.200.169.89/check-nickname",      // 컨트롤러에서 대기중인 URL 주소이다.
			data : {
				nickname : nickname
				},            // Json 형식의 데이터이다.
			success : function(res){ // 비동기통신의 성공일경우 success콜백으로 들어옵니다. 'res'는 응답받은 데이터이다.
				//alert(res);

				if(res == "can make"){
					alert("등록가능한 닉네임 입니다.");
				}else if(res == "already exist"){
					alert("이미 존재하는 닉네임 입니다. 다른 닉네임을 사용해 주세요.");
				}
			},
			error : function(XMLHttpRequest, textStatus, errorThrown){ // 비동기 통신이 실패할경우 error 콜백으로 들어옵니다.
				alert("통신 실패.")
			}
		});
	}
	

	function join_submit(){
		
		var email = $("#email").val();
		var id = $("#id").val();
		var pw = $("#pw").val();
		var pw2 = $("#pw2").val();
		var name = $("#name").val();
		var birth_time = $("#birth_time1").val() + $("#birth_time2").val() + $("#birth_time3").val();
		var phone_nation = $("#phone_nation").val();
		var phone = $("#phone").val();
		var address1 = $("#member_addr").val();
		var address2 = $("#member_addr2").val();
		var nickname = $("#nickname").val();
		var recommender_phone_nation = $("#recommender_phone_nation").val();
		var recommender_phone = $("#recommender_phone").val();
		var recommender_name = $("#recommender_name").val();

		var now_date = new Date();
		var enroll_time = parseInt(now_date.getTime()/1000);
		
        console.log(seller_type);

		if(email==""){
			alert("이메일을 입력해주세요.");
			return false;
		}

        function fn_emailChk(email){
            var regExp = /\w+([-+.]\w+)*@\w+([-.]\w+)*\.[a-zA-Z]{2,4}$/;
            if(!regExp.test(email)){
                return false;
            }
            return true;
        }

        if(!fn_emailChk(email)){
            alert('이메일 형식이 옳바르지 않습니다.');
            return false;
        }
        
		if(id==""){
			alert("아이디를 입력해주세요.");
			return false;
		}

		if(pw==""){
			alert("비밀번호를 입력해주세요.");
			return false;
		}

		if(pw2==""){
			alert("비밀번호를 한번 더 입력해주세요.");
			return false;
		}

		if(name==""){
			alert("이름을 입력해주세요.");
			return false;
		}

		if(seller_type != 'null'){
			if(nickname==""){
				alert("닉네임을 입력해주세요.");
				return false;
			}
		}

		if(address1==""){
			alert("주소를 입력해주세요.");
			return false;
		}

		if(address2==""){
			alert("상세주소를 입력해주세요.");
			return false;
		}

		if(phone_nation==""){
			alert("국가번호를 입력해주세요.");
			return false;
		}

		if(phone==""){
			alert("전화번호를 입력해주세요.");
			return false;
		}

		

		var new_user_type = '';
		if(seller_type == "null"){
			new_user_type = user_type;
		}else if(seller_type != "null"){
			new_user_type = user_type+"_"+seller_type;
		}

		$.ajax({
			type : "POST",            // HTTP method type(GET, POST) 형식이다.
			url : "http://43.200.169.89/enroll-user",      // 컨트롤러에서 대기중인 URL 주소이다.
			data : {
				 email : email,
				 idStr : id,
				 pwdStr : pw,
				 name : name,
				 birth_time : birth_time,
				 phone_nation : phone_nation,
				 phone : phone,
				 address1 : address1,
				 address2 : address2,
				 nickname : nickname,
				 recommender_phone_nation : recommender_phone_nation,
				 recommender_phone : recommender_phone,
				 recommender_name : recommender_name,
				 user_type : new_user_type,
				 enroll_time : enroll_time
				},            // Json 형식의 데이터이다.
			success : function(res){ // 비동기통신의 성공일경우 success콜백으로 들어옵니다. 'res'는 응답받은 데이터이다.
                var get_id = res.split("__")[1];
				alert("회원가입 신청이 완료되었습니다.");
				if(user_type=="seller"){
					location.href="./join_page06.html?user_type="+user_type+"&seller_type="+seller_type+"&id="+get_id+"&recommender_name="+recommender_name+"&recommender_phone="+recommender_phone;
				}else if(user_type=="wholesaler"){
					location.href="./join_page06.html?user_type="+user_type+"&seller_type="+seller_type+"&id="+get_id;
				}else if(user_type=="teacher"){
					location.href="./join_page06.html?user_type="+user_type+"&seller_type="+seller_type+"&id="+get_id;
				}
				
			},
			error : function(XMLHttpRequest, textStatus, errorThrown){ // 비동기 통신이 실패할경우 error 콜백으로 들어옵니다.
				alert("통신 실패.")
			}
		});
	}
</script>
