<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="stylesheet" type="text/css" href="../css/jquery.bxslider.css">
	<link rel="stylesheet" type="text/css" href="../css/defalut.css">
	<link rel="stylesheet" type="text/css" href="../css/style.css">
	<link rel="stylesheet" type="text/css" href="../css/new_style.css">
	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
	<script src="http://code.jquery.com/jquery-latest.min.js"></script>
	<script src="../js/jquery.bxslider.js"></script>
	<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
</head>
<body>
	<div class="container">
		<div class="header">
			
		</div>
		<div class="body">
			<div class="body_infoModify ">
				<div class="body_infoModify_in">
					<h5>나의 정보 관리</h5>
						<table class="join_form">
							<colgroup>
								<col width="16.8%">
								<col width="*">
								<col width="16.3%">
							</colgroup>
							<tbody>
								<tr>
									<th>이름</th>
									<td colspan="2">
										<input type="text" name="name" placeholder="이름을 입력해주세요.">
									</td>
								</tr>
								<tr>
									<th>이메일</th>
									<td>
										<input type="text" name="email" placeholder="이메일 주소를 입력해주세요.">
									</td>
									<td><a href="javascript:void(0)" onclick="emil_check()">중복확인</a></td>
								</tr>
								<tr>
									<th>비밀번호</th>
									<td colspan="2">
										<input type="password" name="pw" placeholder="영문,숫자 조합 8~12자리 이내로 입력해주세요.">
									</td>
								</tr>
								<tr>
									<th>비밀번호 확인</th>
									<td colspan="2">
										<input type="password" name="pw2" placeholder="비밀번호를 한 번 더 입력해주세요.">
									</td>
								</tr>
								<tr>
									<th rowspan="2">주소</th>
									<td>
										<input type="text" id="addr" name="addr" placeholder="주소를 입력해주세요.">
									</td>
									<td><a href="javascript:void(0)" onclick="findAddr()">주소검색</a></td>
								</tr>
								<tr>
									<td colspan="2">
										<input type="text" name="addr2" placeholder="상세주소를 입력해주세요.">
									</td>
								</tr>
								<tr>
									<th>연락처</th>
									<td>
										<input type="text" name="phone_nation" placeholder="+82(한국)" class="w30">
										<input type="text" name="phone" placeholder="전화번호를 입력해주세요." class="w70">
									</td>
								</tr>
							</tbody>
						</table>
						<input type="hidden" name="birth_time">
						<input type="hidden" name="nickname">
						<input type="hidden" name="user_type">
						<a href="javascript:void(0)" class="ok_btn" onclick="modify_submit();">변경 정보 저장</a>
					</div>
				</div>
			</div>
		</div>

		<div class="footer">
			
		</div>
</body>
</html>

<script>
	$(document).ready(function(){
		$('.header').load('head.html');
		$('.footer').load('footer.html');
	});
	
	var now_date = new Date();
	var enroll_time = parseInt(now_date.getTime()/1000);

	var user_id = localStorage.getItem('user_id');
	if(user_id == null){
		user_id = -1; // 비회원
	}
	
	function emil_check(){
		var email = $("input[name=email]").val();
		
		if(email==""){
			alert("이메일을 입력해주세요.");
			return false;
		}

		$.ajax({
			type : "POST",            // HTTP method type(GET, POST) 형식이다.
			url : "http://43.200.169.89/check-email",      // 컨트롤러에서 대기중인 URL 주소이다.
			data : {
				email : email
				},            // Json 형식의 데이터이다.
			success : function(res){ // 비동기통신의 성공일경우 success콜백으로 들어옵니다. 'res'는 응답받은 데이터이다.
				//alert(res);

				if(res == "can make"){
					alert("등록가능한 이메일 입니다.");
				}else if(res == "already exist"){
					alert("이미 존재하는 이메일 입니다. 다른 이메일을 사용해 주세요.");
				}
			},
			error : function(XMLHttpRequest, textStatus, errorThrown){ // 비동기 통신이 실패할경우 error 콜백으로 들어옵니다.
				alert("통신 실패.")
			}
		});
	}

	function findAddr(){
		new daum.Postcode({
			oncomplete: function(data) {
				
				console.log(data);
				
				var roadAddr = data.roadAddress; // 도로명 주소 변수
				var jibunAddr = data.jibunAddress; // 지번 주소 변수

				if(roadAddr !== ''){
					document.getElementById("addr").value = roadAddr;
				} 
				else if(jibunAddr !== ''){
					document.getElementById("addr").value = jibunAddr;
				}
			}
		}).open();
	}

	$.get("http://43.200.169.89/user-info?user_id="+user_id, function(result){

		console.log(result);

		$("input[name=name]").val(result[0].name);
		$("input[name=email]").val(result[0].email);
		$("input[name=addr]").val(result[0].address1);
		$("input[name=addr2]").val(result[0].address2);
		$("input[name=phone_nation]").val(result[0].phone_nation);
		$("input[name=phone]").val(result[0].phone);
		$("input[name=birth_time]").val(result[0].birth_time);
		$("input[name=nickname]").val(result[0].nickname);
		$("input[name=user_type]").val(result[0].user_type);


	
	});

	function modify_submit(){

		var name = $("input[name=name]").val();
		var birth_time = $("input[name=birth_time]").val();
		var phone = $("input[name=phone]").val();
		var address1 = $("input[name=addr]").val();
		var address2 = $("input[name=addr2]").val();
		var nickname = $("input[name=nickname]").val();
		var user_type = $("input[name=user_type]").val();
		var pw = $("input[name=pw]").val();
		var pw2 = $("input[name=pw2]").val();

		if(name == ""){
			alert("이름을 입력해주세요.");
			return;
		}else if(pw == ""){
			alert("비밀번호를 입력해주세요.");
			return;
		}else if(pw2 == ""){
			alert("비밀번호를 입력해주세요.");
			return;
		}else if(address1 == ""){
			alert("주소를 입력해주세요.");
			return;
		}else if(address2 == ""){
			alert("상세주소를 입력해주세요.");
			return;
		}else if(phone == ""){
			alert("연락처를 입력해주세요.");
			return;
		}

		$.post("http://43.200.169.89/revise-user",{
			user_id : user_id,
			name : name,
			birth_time : birth_time,
			phone : phone,
			address1 : address1,
			address2 : address2,
			nickname : nickname,
			user_type : user_type
		},result=>{
			if(result == "success"){
			alert('변경 정보가 저장되었습니다.');
			location.href="main.html";
			}
		})
	}

</script>