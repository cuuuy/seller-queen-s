<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
	<link rel="stylesheet" type="text/css" href="../css/jquery.bxslider.css">
	<link rel="stylesheet" type="text/css" href="../css/defalut.css">
	<link rel="stylesheet" type="text/css" href="../css/admin_defalut.css">
	<link rel="stylesheet" type="text/css" href="../css/new_style.css">
	<link rel="stylesheet" type="text/css" href="../css/admin.css">
	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
	<script src="http://code.jquery.com/jquery-latest.min.js"></script>
	<script src="../js/jquery.bxslider.js"></script>
	<script src="../js/admin.js"></script>
	<link href="../js/air-datepicker/dist/css/datepicker.min.css" rel="stylesheet" type="text/css" media="all">
    <script src="../js/air-datepicker/dist/js/datepicker.js"></script> <!-- Air datepicker js -->
    <script src="../js/air-datepicker/dist/js/i18n/datepicker.ko.js"></script> <!-- 달력 한글 추가를 위해 커스텀 -->
	<script src="https://cdn.ckeditor.com/ckeditor5/34.0.0/classic/ckeditor.js"></script>
	<script src="https://cdn.ckeditor.com/ckeditor5/34.0.0/classic/translations/ko.js"></script>
</head>
<body>
	<div class="container">
		<div class="header_messageLine">
			<div class="header_messageLine_message">
				<span class="message_first">
					온라인 셀러들의 도구,
				</span>
				<span class="message_second">
					헬프스토어 셀러퀸즈
				</span>
			</div>
		</div>
        <div class="admin_m_header">
			<div class="ham">
				<span></span>
				<span></span>
				<span></span>
			</div>
			<a href=""><img src="../image/admin_back.png" alt="" /></a>
			<a href="../html/main.html" class="header_gnb_logo">
				<img src="../image/logo.png">
			</a>
			<div>
				<span>김관리자</span> 님
			</div>
		</div>
		<div class="adminContainer">
			<!-- rightmenu -->
			<div class="rightmenuWrap"></div>
			<div class="adminWrap">
				 <div class="adminWrap_topmenu">
					<ul>
						<li class="active"><a href="./admin_admin_main.html">관리자 센터</a></li>
						<li><a href="./admin_seller_main.html">셀러 센터</a></li>
						<li><a href="./admin_domae_main.html">도매 센터</a></li>
						<li><a href="./admin_teacher_main.html">강사 센터</a></li>
					</ul>
				</div>
				<div class="adminWrap_title">
					<a href="./admin_admin_main.html"><img src="../image/admin_back.png" alt="" /></a>
					<h3>웹 페이지 설정</h3>
				</div> 
					<div class="adminContent_right">
						<div>
							<table class="adminContent_table">
								<colgroup>
									<col width="3%">
									<col width="3%">
									<col width="*">
									<col width="10%">
									<col width="10%">
									<col width="10%">
									<!-- <col width="10%"> -->
									<col width="10%">
									<col width="10%">
									<col width="10%">
								</colgroup>
								<thead>
									<th></th>
									<th>No.</th>
									<th>제목</th>
									<th>노출 매체<br>(미리보기)</th>
									<th>노출 기간</th>
									<!-- <th>등록일</th> -->
									<th>상태</th>
									<th>순위 조정</th>
									<th>삭제</th>
									<th>수정</th>
								</thead>
								<tbody class="adminContent_banner_list">
									<!-- <tr>
										<td>
											<div class="adminContent_table_checkbox">
												<input id="check02" type="checkbox">
												<label for="check02"><span></span></label>
											</div>
										</td>
										<td>1</td>
										<td class="adminContent_table_name">
											<p>메인배너</p>
										</td>
										<td>웹</td>
										<td>2022.03.14 12:00:00<br>~2022.04.15 12:00:00</td>
										<td>2022.03.14 13:22:40</td>
										<td>업로드 완료</td>
										<td></td>
										<td>
											<div class="adminContent_search">
												<a href="" class="check_btn">삭제</a>
											</div>
										</td>
										<td>
											<div class="adminContent_search">
												<a href="" class="check_btn">수정</a>
											</div>
										</td>
									</tr> -->
								</tbody>
							</table>
						</div>
						<a href="javascript:void(0)" class="modalBanner">+ 배너 추가</a>
							<!-- <div class="adminContent_pager">
								<span class="active">1</span>
								<span>2</span>
								<span>3</span>
							</div> -->
						</div>
						
					</div>
				</div>
			</div>
		</div>
	</div>
	<form method="POST" enctype="multipart/form-data" id="uploadForm">
		<div class="adminModal" id="modalBanner" style="display:none;">
			<div class="adminModal_cont" style="overflow-y: auto;height: 88%;">
				<h3>배너 추가</h3>
				<div>
					<table class="modalBanner_table">
						<colgroup>
							<col width="10%">
							<col width="*">
						</colgroup>
						<tbody>
							<tr>
								<th>
									제목
								</th>
								<td>
									<input type="text" name="banner_title" placeholder="제목을 입력해주세요">
								</td>
							</tr>
							<tr>
								<th>
									노출기간
								</th>
								<td>
									<div id="start_date">
										<h5 style="text-align:left;">배너 업로드 시작</h5>
										<input type="text" id="new_start_date" name="start_date" style="display:none;">
									</div>
									
									<div id="end_date">
										<h5 style="text-align:left;">배너 업로드 종료</h5>
										<input type="text" id="new_end_date" name="end_date" style="display:none;">
									</div>
								</td>
							</tr>
							<tr>
								<th>
									위치
								</th>
								<td>
									<select name="typeStr">
										<option value="main_banner">메인배너</option>
										<option value="bottom_menu1">하단메뉴1</option>
										<option value="bottom_menu2">하단메뉴2</option>
										<option value="bottom_menu3">하단메뉴3</option>
										<option value="bottom_menu4">하단메뉴4</option>
									<select>
								</td>
							</tr>
							<tr>
								<th>
									텍스트
								</th>
								<td>
									<!-- <textarea rows="20" cols="100" name="descStr" placeholder="텍스트를 입력해주세요" style="background-color:#EAE6F2;border:none;padding: 20px;resize:none;"></textarea> -->
									<textarea name="descStr" id="editor"></textarea>
								</td>
							</tr>
							<tr>
								<th>
									이미지
								</th>
								<td>
									<!-- <img src="../image/market_imgplus.png" alt="" width="80"/> -->
									<!-- 파일 스크립트 -->
									<input type="file" name="main_img" id="main_img">
								</td>
							</tr>
						</tbody>
					</table>
				</div>
				<div class="adminModal_cont_btn">
					<a href="" class="back_btn modalClose">취소</a>
					<a href="javascript:void(0)" class="ok_btn modi_btn" onclick="add_banner()">저장</a>
				</div>
			</div>
		</div>
        <div class="adminModal_m" id="modalBanner" style="display:none;">
			<div class="adminModal_cont" style="overflow-y: auto;height: 88%;">
				<h3>배너 추가</h3>
				<div>
					<table class="modalBanner_table">
						<colgroup>
							<col width="90%">
						</colgroup>
						<tbody>
                            <tr>
								<th>
									제목
								</th>
							</tr>
							<tr>
								<td colspan="2">
									<input type="text" name="banner_title" placeholder="제목을 입력해주세요">
								</td>
							</tr>
                            <tr>
								<th>
									노출기간
								</th>
							</tr>
							<tr>
                                <td class="2">
                                    <div id="start_date">
                                        <h5 style="text-align:left;">배너 업로드 시작</h5>
                                        <input type="text" id="new_start_date" name="start_date" style="display:none;">
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td class="2">
                                    <div id="end_date" style="margin: 0 0px 0 0;">
                                        <h5 style="text-align:left;">배너 업로드 종료</h5>
                                        <input type="text" id="new_end_date" name="end_date" style="display:none;">
                                    </div>
                                </td>
                            </tr>
                            <tr>
								<th>
									위치
								</th>
							</tr>
							<tr>
								<td colspan="2">
									<select name="typeStr">
										<option value="main_banner">메인배너</option>
										<option value="bottom_menu1">하단메뉴1</option>
										<option value="bottom_menu2">하단메뉴2</option>
										<option value="bottom_menu3">하단메뉴3</option>
										<option value="bottom_menu4">하단메뉴4</option>
									<select>
								</td>
							</tr>
                            <tr>
								<th>
									텍스트
								</th>
							</tr>
							<tr>
								<td>
									<textarea name="descStr" id="editor"></textarea>
								</td>
							</tr>
                            <tr>
								<th>
									이미지
								</th>
							</tr>
							<tr>
								<td>
									<input type="file" name="main_img" id="main_img">
								</td>
							</tr>
						</tbody>
					</table>
				</div>
				<div class="adminModal_cont_btn">
					<a href="" class="back_btn modalClose">취소</a>
					<a href="javascript:void(0)" class="ok_btn modi_btn" onclick="add_banner()">저장</a>
				</div>
			</div>
		</div>
        
	</form>
</body>

</html>

<script>

    function Mobile(){
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);}
	
    if (Mobile()){// 모바일일 경우
        $(".adminModal_m").hide();
        $(".adminModal").remove();
    } else {// 모바일 외
        $(".adminModal_m").remove();
        $(".adminModal").hide();
    }

	var now_date = Date.now();
	var enroll_time = now_date/1000;

	var user_id = localStorage.getItem('user_id');
	if(user_id == null){
		user_id = -1; // 비회원
	}
	
	ClassicEditor
	.create(document.querySelector("#editor"),
		{
			language: "ko",
			simpleUpload:
			{
				withCredentials: true,
			}
		})
	.then(newEditor => {
		editor = newEditor;
	})
	.catch(error => {
		console.error(error);
	});

	$(document).ready(function() {
		$('.rightmenuWrap').load('admin_admin_rightmenu.html');
		
		$('.adminModal a').attr('href','javascript:void(0)');
		$('.adminModal').hide();
		$('.modalBanner').click(function(){
			$('#modalBanner').show();
		});
		$('.modalClose').click(function(){
			$('.adminModal').hide();
		});

		$("#start_date").datepicker({
			language: 'ko',
			timepicker: true,
			timeFormat: "hh:ii AA",
			onSelect: function(dateText, inst) {
				var new_date = new Date(dateText);
				
				$("#new_start_date").val(new_date.getTime()/1000);

			}
		});

		$("#end_date").datepicker({
			language: 'ko',
			timepicker: true,
			timeFormat: "hh:ii AA",
			onSelect: function(dateText, inst) {
				var new_date = new Date(dateText);
				
				$("#new_end_date").val(new_date.getTime()/1000);

			}
		});
		
		load_banner();

	});
	
	function add_banner(){
		
		var title = $("input[name=banner_title]").val();
		var start_time = $("#new_start_date").val();
		var end_time = $("#new_end_date").val();
		var descStr = $("textarea[name=descStr]").val();
		var typeStr = $("select[name=typeStr]").val();
		
		if(title == ""){
			alert("제목을 입력해주세요.");
			return false;
		}

		if(start_time == ""){
			//alert("업로드 시작일을 입력해주세요.");
			//return false;
		}

		if(end_time == ""){
			//alert("업로드 종료일을 입력해주세요.");
			//return false;
		}
		
		if($("#main_img").val()==""){
			alert("이미지를 첨부해주세요.");
			return false;
		}
		var form = $('#uploadForm')[0];
		var form_data = new FormData();
		
		form_data.append('title', title);
		form_data.append('user_id', '-1');//관리자
		form_data.append('start_time', start_time);
		form_data.append('end_time', end_time);
		form_data.append('descStr', descStr);
		form_data.append('typeStr', typeStr);
		form_data.append('file', $("#main_img")[0].files[0]);
		
		//console.log(form_data);

		// ajax 통신
		$.ajax({
			type : "POST",            // HTTP method type(GET, POST) 형식이다.
			url : "http://43.200.169.89/enroll-banner",      // 컨트롤러에서 대기중인 URL 주소이다.
			contentType: false,
			processData: false,
			//enctype: 'multipart/form-data',
			data : form_data,            // Json 형식의 데이터이다.
			success : function(res){ // 비동기통신의 성공일경우 success콜백으로 들어옵니다. 'res'는 응답받은 데이터이다.
				// 응답코드 > 0000
				//alert(res);

				if(res == "success"){
					alert("배너가 등록 되었습니다.");
					$('.adminModal').hide();
					location.reload();
				}else{
					alert("오류 발생. 관리자에게 문의하세요.");
				}
			},
			error : function(XMLHttpRequest, textStatus, errorThrown){ // 비동기 통신이 실패할경우 error 콜백으로 들어옵니다.
				alert("통신 실패.")
			}
		});
	}

	function load_banner(){
		// ajax 통신
		$.ajax({
			type : "GET",            // HTTP method type(GET, POST) 형식이다.
			url : "http://43.200.169.89/banners?user_id="+"-1",      // 컨트롤러에서 대기중인 URL 주소이다.
			data : {
				
				},            // Json 형식의 데이터이다.
			success : function(res){ // 비동기통신의 성공일경우 success콜백으로 들어옵니다. 'res'는 응답받은 데이터이다.
				// 응답코드 > 0000
				console.log(res);
				
				for(var i = 0; i < res.length; i++){
					
					var unix_timestamp = res[i].start_time;
					var date = new Date(unix_timestamp * 1000);
					var hours = date.getHours();
					var minutes = "0" + date.getMinutes();
					var seconds = "0" + date.getSeconds();
					var mon = (date.getMonth()+1);
					var formattedTime = date.getFullYear() + "-" + mon + "-" + date.getDate() + " " + hours + ':' + minutes.substr(-2) + ':' + seconds.substr(-2);

					var unix_timestamp2 = res[i].end_time;
					var date2 = new Date(unix_timestamp2 * 1000);
					var hours2 = date2.getHours();
					var minutes2 = "0" + date2.getMinutes();
					var seconds2 = "0" + date2.getSeconds();
					var mon2 = (date2.getMonth()+1);
					var formattedTime2 = date2.getFullYear() + "-" + mon2 + "-" + date2.getDate() + " " + hours2 + ':' + minutes2.substr(-2) + ':' + seconds2.substr(-2);

					var img_path = res[i].image_url.replace("public","");
					if(res[i].typeStr == "main_banner"){
						typeStr = "메인 배너";
					}else if(res[i].typeStr == "bottom_menu1"){
						typeStr = "하단메뉴1";
					}else if(res[i].typeStr == "bottom_menu2"){
						typeStr = "하단메뉴2";
					}else if(res[i].typeStr == "bottom_menu3"){
						typeStr = "하단메뉴3";
					}else if(res[i].typeStr == "bottom_menu4"){
						typeStr = "하단메뉴4";
					}

					//var new_html = `<li>
					//			<h4>${typeStr}</h4>
					//			<h5>`+res[i].title+`</h5>
					//			<span style="background: url(http://43.200.169.89`+img_path+`) no-repeat; background-size : cover;"></span>
					//			<p>기간: ${formattedTime} ~ ${formattedTime2}</p>
					//			<div class="adminContent_banner_list_btn" >
					//				<a href="javascript:void(0)" class="ok_btn banner_modi" onclick="modi_banner_show(`+res[i].id+`);" data-index="${res[i].id}" ">수정</a>
					//				<a href="javascript:void(0)" class="back_btn" onclick="remove_banner(`+res[i].id+`);">삭제</a>
					//			</div>
					//		</li>`;
					var new_html = `<tr>
										<td>
											<div class="adminContent_table_checkbox">
												<input id="check02" type="checkbox">
												<label for="check02"><span></span></label>
											</div>
										</td>
										<td>${i+1}</td>
										<td class="adminContent_table_name">
											<p>${typeStr}</p>
											<p>${res[i].title}</p>
										</td>
										<td>웹</td>
										<td>${formattedTime}<br>~${formattedTime2}</td>
										<!--<td>2022.03.14 13:22:40</td>-->
										<td>업로드 완료</td>
										<td></td>
										<td>
											<div class="adminContent_search">
												<a href="javascript:void(0)" class="back_btn" onclick="remove_banner(`+res[i].id+`);">삭제</a>
											</div>
										</td>
										<td>
											<div class="adminContent_search">
												<a href="javascript:void(0)" class="ok_btn banner_modi" onclick="modi_banner_show(`+res[i].id+`);" data-index="${res[i].id}" ">수정</a>
											</div>
										</td>
									</tr>`;

					$(".adminContent_banner_list").append(new_html);
				}

			},
			error : function(XMLHttpRequest, textStatus, errorThrown){ // 비동기 통신이 실패할경우 error 콜백으로 들어옵니다.
				alert("통신 실패.")
			}
		});
	}
	function modi_banner_show(id){
		$('#modalBanner').show();
		$(".modi_btn").attr("onclick","modi_banner("+id+")");
	}

	function modi_banner(banner_id){
		
		//var banner_id = $(".banner_modi").data('index');
		//console.log(banner_modi);
		//return;
		var title = $("input[name=banner_title]").val();
		var start_time = $("#new_start_date").val();
		var end_time = $("#new_end_date").val();
		//var descStr = $("input[name=product_domae_price]").val();
		//var typeStr = $("input[name=product_price]").val();
		
		var form = $('#uploadForm')[0];
		var form_data = new FormData();

		form_data.append('banner_id', banner_id);
		form_data.append('title', title);
		form_data.append('user_id', "-1");
		form_data.append('start_time', start_time);
		form_data.append('end_time', end_time);
		form_data.append('descStr', 'test');
		form_data.append('typeStr', 'test2');
		form_data.append('file', $("#main_img")[0].files[0]);
		
		//console.log(form_data);

		// ajax 통신
		$.ajax({
			type : "POST",            // HTTP method type(GET, POST) 형식이다.
			url : "http://43.200.169.89/revise-banner",      // 컨트롤러에서 대기중인 URL 주소이다.
			contentType: false,
			processData: false,
			//enctype: 'multipart/form-data',
			data : form_data,            // Json 형식의 데이터이다.
			success : function(res){ // 비동기통신의 성공일경우 success콜백으로 들어옵니다. 'res'는 응답받은 데이터이다.
				// 응답코드 > 0000
				//alert(res);

				if(res == "success"){
					alert("배너가 수정 되었습니다.");
					$('.adminModal').hide();
					location.reload();
				}else{
					alert("오류 발생. 관리자에게 문의하세요.");
				}
			},
			error : function(XMLHttpRequest, textStatus, errorThrown){ // 비동기 통신이 실패할경우 error 콜백으로 들어옵니다.
				alert("통신 실패.")
			}
		});
	}

	function remove_banner(id){
		// ajax 통신
		$.ajax({
			type : "POST",            // HTTP method type(GET, POST) 형식이다.
			url : "http://43.200.169.89/remove-banner",      // 컨트롤러에서 대기중인 URL 주소이다.
			data : {
					banner_id : id,
					user_id : "-1"
				},            // Json 형식의 데이터이다.
			success : function(res){ // 비동기통신의 성공일경우 success콜백으로 들어옵니다. 'res'는 응답받은 데이터이다.
				// 응답코드 > 0000
				console.log(res);
				
				if(res == "success"){
					alert("배너가 삭제 되었습니다.");
					location.reload();
				}else{
					alert("오류 발생. 관리자에게 문의하세요.");
				}

			},
			error : function(XMLHttpRequest, textStatus, errorThrown){ // 비동기 통신이 실패할경우 error 콜백으로 들어옵니다.
				alert("통신 실패.")
			}
		});
	}
</script>
