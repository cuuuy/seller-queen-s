<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
	<link rel="stylesheet" type="text/css" href="../css/jquery.bxslider.css">
	<link rel="stylesheet" type="text/css" href="../css/defalut.css">
	<link rel="stylesheet" type="text/css" href="../css/admin_defalut.css">
	<link rel="stylesheet" type="text/css" href="../css/new_style.css">
	<link rel="stylesheet" type="text/css" href="../css/admin.css">
	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
	<script src="http://code.jquery.com/jquery-latest.min.js"></script>
	<script src="../js/jquery.bxslider.js"></script>
	<link href="../js/air-datepicker/dist/css/datepicker.min.css" rel="stylesheet" type="text/css" media="all">
    <script src="../js/air-datepicker/dist/js/datepicker.js"></script> <!-- Air datepicker js -->
    <script src="../js/air-datepicker/dist/js/i18n/datepicker.ko.js"></script> <!-- 달력 한글 추가를 위해 커스텀 -->
	<script src="https://cdn.ckeditor.com/ckeditor5/34.0.0/classic/ckeditor.js"></script>
	<script src="https://cdn.ckeditor.com/ckeditor5/34.0.0/classic/translations/ko.js"></script>
	<script src="../js/pagination.min.js"></script>
	<script src="../js/admin.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/paginationjs/2.1.4/pagination.css"/>
</head>
<body>
	<div class="container">
		<div class="header_messageLine">
			<div class="header_messageLine_message">
				<span class="message_first">
					온라인 셀러들의 도구,
				</span>
				<span class="message_second">
					헬프스토어 셀러퀸즈
				</span>
			</div>
		</div>
		<div class="admin_m_header">
			<div class="ham">
				<span></span>
				<span></span>
				<span></span>
			</div>
			<a href=""><img src="../image/admin_back.png" alt="" /></a>
			<a href="../html/main.html" class="header_gnb_logo">
				<img src="../image/logo.png">
			</a>
			<div>
				<span>김관리자</span> 님
			</div>
		</div>
		<div class="adminContainer">
			<!-- rightmenu -->
			<div class="rightmenuWrap"></div>
			<div class="adminWrap">
				 <div class="adminWrap_topmenu">
					<ul>
						<li><a href="./admin_admin_main.html">관리자 센터</a></li>
						<li><a href="./admin_seller_main.html">셀러 센터</a></li>
						<li class="active"><a href="./admin_domae_main.html">도매 센터</a></li>
						<li><a href="./admin_teacher_main.html">강사 센터</a></li>
					</ul>
				</div>
				<div class="adminWrap_title">
					<a href=""><img src="../image/admin_back.png" alt="" /></a>
					<h3>상품관리</h3>
					<p>★셀러 안내 사항 : 상품의 공급은 도매판매자의 판매상품이 자동으로 업데이트 되며, 셀럽님들께서는 도매상의 상품을  자유롭게 ON/OFF하실 수 있습니다.</p>
				</div> 
				<div class="adminContent">
					<!-- <div class="adminContent_leftmenu">
						<h4>카테고리 관리</h4>
						<ul>
							<li class="adminContent_leftmenu_drop">ALL</li>
						</ul>
						<ul>
							<li>
								<div class="adminContent_leftmenu_title">
									악세서리
									<label class="switch">
										<input type="checkbox">
										<span class="slider round"></span>
									</label>
								</div>
								<ul>
									<li>
										시계
										<label class="switch">
											<input type="checkbox">
											<span class="slider round"></span>
										</label>
									</li>
									<li>
										팔찌
										<label class="switch">
											<input type="checkbox">
											<span class="slider round"></span>
										</label>
									</li>
									<li>
										귀걸이
										<label class="switch">
											<input type="checkbox">
											<span class="slider round"></span>
										</label>
									</li>
								</ul>
							</li>
							<li>
								<div class="adminContent_leftmenu_title">
									의류
									<label class="switch">
										<input type="checkbox">
										<span class="slider round"></span>
									</label>
								</div>
								<ul>
									<li>
										상의
										<label class="switch">
											<input type="checkbox">
											<span class="slider round"></span>
										</label>
									</li>
									<li>
										하의
										<label class="switch">
											<input type="checkbox">
											<span class="slider round"></span>
										</label>
									</li>
									<li>
										아우터
										<label class="switch">
											<input type="checkbox">
											<span class="slider round"></span>
										</label>
									</li>
									<li>
										신발
										<label class="switch">
											<input type="checkbox">
											<span class="slider round"></span>
										</label>
									</li>
								</ul>
							</li>
						</ul>
						<p class="adminContent_leftmenu_modify"><img src="../image/admin_products_modify.jpg" alt="" /></p>
					</div> -->
					<div class="adminContent">
						<div class="adminContent_tab">
							<ul>
								<li class="filter_all active"><a href="javascript:void(0)">전체 <span class="total_num">0</span></a></li>
								<li class="filter_sell"><a href="javascript:void(0)">판매중 <span class="sell_num">0</span></a></li>
								<li class="filter_sold"><a href="javascript:void(0)">품절 <span class="sold_num">0</span></a></li>
							</ul>
						</div>
						<div class="adminContent_check adminContent_check_right">
							<!-- <input id="check01" type="checkbox"> -->
							<!-- <label for="check01"><span></span>베스트 아이템 설정</label> -->
						</div>
						<div class="adminContent_search">
							<input type="text" name="search_product" placeholder="상품명을 검색하세요." onkeyup="enterkey()">
							<a href="javascript:void(0)" class="check_btn onmodal">상품업로드</a>
							<a href="javascript:void(0)" class="check_btn search_btn">검색</a>
						</div>
						<div style="min-height: 700px;">
							<table class="adminContent_table">
								<colgroup>
									<col width="3%">
									<col width="3%">
									<col width="*">
									<col width="8%">
									<col width="10%">
									<col width="8%">
									<col width="8%">
									<col width="8%">
									<col width="8%">
									<col width="8%">
									<col width="8%">
									<col width="8%">
								</colgroup>
								<thead>
									<th></th>
									<th>NO.</th>
									<th>상품명</th>
									<th>도매처</th>
									<th>카테고리</th>
									<th>지정 판매가</th>
									<th>상태</th>
									<th>재고</th>
									<th>등록일</th>
									<th>배송비</th>
									<th>상품 표시</th>
									<th>수정</th>
								</thead>
								<tbody id="product_load_tbody">
									
								</tbody>
							</table>
						</div>
						<div class="adminContent_pager" id="paging">
						</div>
					</div>
				</div>
			</div>
		</div>
		<form method="POST" enctype="multipart/form-data" id="uploadForm">
		<div class="adminModal modalPage01" style="display:none;">
			<div class="adminModal_cont">
				<h3>상품 업로드</h3>
				<a href="javascript:void(0)" class="adminModal_cont_plusbtn">+ 옵션추가</a>
				<div>
					<table class="adminModal_cont_table">
						<colgroup>
							<col width="*">
							<col width="10%">
							<col width="10%">
							<col width="10%">
							<col width="15%">
							<col width="8%">
							<col width="10%">
						</colgroup>
						<thead>
							<tr>
								<th>상품명</th>
								<th>도매처</th>
								<th>카테고리</th>
								<th>도매가</th>
								<th>소매 지정 판매가</th>
								<th>재고</th>
								<th>배송비</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<!-- <span>하트 컬러 볼 시계</span> -->
									<input type="text" class="admin_input2" name="product_name">
								</td>
								<td>
									<!-- <span>시계나라</span> -->
									<input type="text" class="admin_input2" name="product_domae">
								</td>
								<td>
									<span>
										<select class="product_category" name="product_category">
											<!-- <option value="시계">시계</option>
											<option value="남성의류">남성의류</option>
											<option value="악세서리">악세서리</option> -->
										</select>
									</span>
								</td>
								<td>
									<!-- <span>700,000원</span> -->
									<input type="text" class="admin_input2" name="product_domae_price" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\.*)\./g, '$1');">
								</td>
								<td>
									<!-- <span>900,000원</span> -->
									<input type="text" class="admin_input2" name="product_price" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\.*)\./g, '$1');">
								</td>
								<td>
									<!-- <span>20</span> -->
									<input type="text" class="admin_input2" name="product_amount" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\.*)\./g, '$1');">
								</td>
								<td>
									<input type="text" class="admin_input2" name="product_deli" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\.*)\./g, '$1');">
									<!-- <span>
										<select name="product_deli">
											<option value="3500">3,500원</option>
											<option value="3000">3,000원</option>
											<option value="2500">2,500원</option>
										</select>
									</span> -->
								</td>
							</tr>
						</tbody>
					</table>
				</div>
				<div>
					<h5 style="border-bottom: 0.5px solid;padding-bottom: 10px;">상품업로드 기간</h5>
					<!-- 달력 스크립트 -->
					<div>
						
						<div id="start_date">
							<h5 style="text-align:left;">상품업로드 시작</h5>
							<input type="text" id="new_start_date" name="start_date" style="display:none;">
						</div>
						
						<div id="end_date">
							<h5 style="text-align:left;">상품업로드 종료</h5>
							<input type="text" id="new_end_date" name="end_date" style="display:none;">
						</div>
					</div>
				</div>
				
				<div class="adminModal_cont_btn">
					<a href="" class="back_btn modalClose">취소</a>
					<a href="javascript:void(0)" class="ok_btn modalNext1" onclick="product_valid()">다음</a>
				</div>
			</div>
		</div>


		<!-- 옵션추가 -->
		<div class="adminModal modalPage02" style="display:none;">
			<div class="adminModal_cont">
				<h3>상품 옵션추가</h3>
				<table class="adminModal_cont_table">
					<colgroup>
						<col width="*">
						<col width="10%">
						<col width="10%">
						<col width="10%">
						<col width="12%">
						<col width="8%">
						<col width="10%">
					</colgroup>
					<thead>
						<tr>
							<th>상품명</th>
							<th>도매처</th>
							<th>카테고리</th>
							<th>도매가</th>
							<th>소매 지정 판매가</th>
							<th>재고</th>
							<th>배송비</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>
								<span><input type="text" name="" placeholder="상품명"></span>
							</td>
							<td>
								<span><input type="text" name="" placeholder="도매처"></span>
							</td>
							<td>
								<span>
									<select class="product_category" name="product_category">
										<!-- <option value="시계">시계</option>
										<option value="남성의류">남성의류</option>
										<option value="악세서리">악세서리</option> -->
									</select>
								</span>
							</td>
							<td>
								<span><input type="text" name="" placeholder="도매가"></span>
							</td>
							<td>
								<span><input type="text" name="" placeholder="소매지정판매가"></span>
							</td>
							<td>
								<span><input type="text" name="" placeholder="재고"></span>
							</td>
							<td>
								<input type="text" class="admin_input2" name="product_deli">
							</td>
						</tr>
						<!-- <tr>
							<td>
								<span><input type="text" name="" placeholder="상품명"></span>
							</td>
							<td>
								<span><input type="text" name="" placeholder="도매처"></span>
							</td>
							<td>
								<span><select name="">
										<option>시계</option>
										<option>남성의류</option>
										<option>악세서리</option>
									</select></span>
							</td>
							<td>
								<span><input type="text" name="" placeholder="도매가"></span>
							</td>
							<td>
								<span><input type="text" name="" placeholder="소매지정판매가"></span>
							</td>
							<td>
								<span><input type="text" name="" placeholder="재고"></span>
							</td>
							<td>
								<span><select name="">
										<option>3,500원</option>
										<option>3,000원</option>
										<option>2,500원</option>
									</select></span>
							</td>
						</tr> -->
						<tr>
							<td colspan="7">
								<a href="" class="plusbtn">+</a>
							</td>
						</tr>
					</tbody>
				</table>
				<div style="white-space: nowrap;overflow:auto;display:flex;">
					<div class="option_div" id="first_option_div">
						<p><input type="text" class="option_name" name="option_name" placeholder="옵션명 입력"></p>
						<p id="option_p"><input type="text" class="option_selections" name="option_selections" placeholder="옵션을 입력해주세요"></p>
						<a style="text-align:center;" class="option_plus" id="option_plus" onclick="option_plus()">+</a>
					</div>
					<!-- <div class="option_div">
						<p><input type="text" name="option_name2" placeholder="옵션명 입력"></p>
						<p id="option_p2"><input type="text" name="options2[]" placeholder="옵션을 입력해주세요"></p>
						<a style="text-align:center;" id="option_plus2" onclick="option_plus(2)">+</a>
					</div>
					<div class="option_div">
						<p><input type="text" name="option_name3" placeholder="옵션명 입력"></p>
						<p id="option_p3"><input type="text" name="options3[]" placeholder="옵션을 입력해주세요"></p>
						<a style="text-align:center;" id="option_plus3" onclick="option_plus(3)">+</a>
					</div>
					<div class="option_div">
						<p><input type="text" name="option_name4" placeholder="옵션명 입력"></p>
						<p id="option_p4"><input type="text" name="options4[]" placeholder="옵션을 입력해주세요"></p>
						<a style="text-align:center;" id="option_plus4" onclick="option_plus(4)">+</a>
					</div> -->
				</div>
				<div class="adminModal_cont_btn">
					<a href="javascript:void(0)" class="back_btn modalClose">취소</a>
					<a class="ok_btn modalNext1-1" onclick="option_add();">옵션 설정 완료</a>
				</div>
			</div>
		</div>

		<!-- 상품 업로드 -->
		<div class="adminModal modalPage03" style="display:none;">
			<div class="adminModal_cont">
				<h3>상품 업로드</h3>
				<div>
					<h5>메인 사진</h5>
					<!-- 파일업로드 스크립트 -->
					<!-- <form method="POST" enctype="multipart/form-data" id="uploadForm"> -->
						<!-- <div> -->
							<input type="file" name="main_img" id="main_img">
							<!-- <a href="" class="adminModal_cont_uploadbtn">파일 찾기</a> -->
						<!-- </div> -->
					
				</div>
				<div>
					<h5 style="margin-bottom:10px;">상품 사진 및 설명</h5>
					<!-- 스마트에디터 -->
					<textarea name="product_content" id="editor"></textarea>
					<div>
					</div>
				</div>
				<div class="adminModal_cont_btn">
					<a href="" class="back_btn modalClose">취소</a>
					<a href="javascript:void(0)" class="ok_btn modalNext2" onclick="product_add()">다음</a>
				</div>
			</div>
		</div>

		<!-- 완료 -->
		<div class="adminModal modalPage04" style="display:none;">
			<div class="adminModal_ok">
				<h3>상품 추가가 완료되었습니다!</h3>
				<div class="adminModal_ok_btn">
					<a href="" class="ok_btn modalClose">확인</a>
				</div>
			</div>
		</div>

        </form>
		<!-- 카테고리관리 -->
		<div class="adminModal admincategory" style="display:none;">
			<div class="adminModal_cont adminModal_category" id="category_div">
				<h3>카테고리관리</h3>
				<div style="width:100%;">
					<div style="white-space: nowrap;overflow:auto;display:flex;" class="category_section">
						<div class="category_row category_row2 desc">
							<p>대분류</p>
							<p>중분류</p>
							<p>소분류</p>
						</div>
						<div class="category_row">
							<div class="category_1depth">
								<div class="top">
									<input id="category1_id_1" type="checkbox" name="category_chkbox" data-type="category1">
									<label for="category1_id_1"><span></span>의류</label>
								</div>
								<div class="bottom_list">
									<div class="category_2depth">
										<div class="top">
											<input id="category2_id_1" type="checkbox" name="category_chkbox" data-type="category2">
											<label for="category2_id_1"><span></span>아동복</label>
										</div>
										<div class="bottom_list">
											<div class="category_3depth">
												<div class="top">
													<input id="category3_id_1" type="checkbox" name="category_chkbox" data-type="category3">
													<label for="category3_id_1"><span></span>상의</label>
												</div>
												<div class="bottom_list">
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
				</div>
				<div class="adminModal_category_plus">
					<select name="category_select" disabled>
						<option value="">분류 선택</option>
						<option value="category1">대분류</option>
						<option value="category2">중분류</option>
						<option value="category3">소분류</option>
					</select>
					<input type="text" name="category_name">
				</div>
				<div class="adminModal_category_btn">
					<a href="javascript:void(0)" class="on" onclick="category_add()">추가</a>
					<a href="javascript:void(0)" onclick="category_modify()">수정</a>
					<a href="javascript:void(0)" class="plusnone" onclick="category_delete()">삭제</a>
				</div>
				<div class="adminModal_cont_btn">
					<a href="" class="back_btn modalClose">취소</a>
					<a href="javascript:void(0)" class="ok_btn modalClose" onclick="category_save();">저장</a>
				</div>
			</div>
		</div>


	</div>
</body>

</html>

<script>
	var user_id = localStorage.getItem('user_id');
	var productInfoDict = [];
	var products= [];
	var products_origin = [];
	
	var page_num = 0;

	$(document).ready(function() {
		
		product_load();
		category_load();

		ClassicEditor
        .create(document.querySelector("#editor"),
            {
                language: "ko",
                simpleUpload:
                {
                    uploadUrl: "http://43.200.169.89/image-upload",
                    withCredentials: true,
                }
            })
        .then(newEditor => {
            editor = newEditor;
        })
        .catch(error => {
            console.error(error);
        });

		$('.rightmenuWrap').load('admin_domae_rightmenu.html');

		$('.adminModal').hide();
		$('.adminModal a').attr('href','javascript:void(0)');
		$('.onmodal').click(function(){
			$('.modalPage01').show();
		});
		$('.adminModal_cont_plusbtn').click(function(){
			$('.modalPage01').hide();
			$('.modalPage02').show();
		});
		$('.modalNext1').click(function(){
			//$('.modalPage01').hide();
			//$('.modalPage03').show();
		});
		$('.modalNext1-1').click(function(){
			//$('.modalPage02').hide();
			//$('.modalPage01').show();
		});
		$('.modalNext2').click(function(){
			//$('.modalPage03').hide();
			//$('.modalPage04').show();
		});
		$('.modalClose').click(function(){
			$('.adminModal').hide();
            location.reload();
		});
		$('.adminModal_category_btn a').click(function(){
			$(this).addClass('on');
			$(this).siblings().removeClass('on');
			$('.adminModal_category_plus').show();
		});
		$('.plusnone').click(function(){
			//$('.adminModal_category_plus').hide();
		});
		$('.adminContent_leftmenu_modify').click(function(){
			$('.admincategory').show();
		});

	});
	
	$("#start_date").datepicker({
		language: 'ko',
		timepicker: true,
		timeFormat: "hh:ii AA",
		onSelect: function(dateText, inst) {
			var new_date = new Date(dateText);
			
			$("#new_start_date").val(new_date.getTime()/1000);

     }
	});

	$("#end_date").datepicker({
		language: 'ko',
		timepicker: true,
		timeFormat: "hh:ii AA",
		onSelect: function(dateText, inst) {
			var new_date = new Date(dateText);
			
			$("#new_end_date").val(new_date.getTime()/1000);

     }
	});

	var parent_id = 0;
	var checked_type = 0;
	//$("body").on("change",".input[type=checkbox][name='category_chkbox']", function(){
	//	
	//});
	$("body").on("change","input[type=checkbox][name='category_chkbox']", function(e){
		console.log(e.target);
		if($(e.target).closest("input[type=checkbox][name='category_chkbox']").prop('checked')){
			$('input[type="checkbox"][name="category_chkbox"]').prop('checked',false);
			$(e.target).prop('checked',true);

			var category_num = $(e.target).data('type');

			if(category_num=='category1'){
				checked_type = 1;
				$("select[name=category_select]").val('category2');
			}else if(category_num=='category2'){
				checked_type = 2;
				$("select[name=category_select]").val('category3');
			}else if(category_num=='category3'){
				checked_type = 3;
				$("select[name=category_select]").val('');
			}
		}else{ // 체크 풀릴때
			checked_type = 0;
			$("select[name=category_select]").val('category1');
		}


		//console.log($(this).attr('id').split('_')[0]);

		//if($(this).attr('id').split('_')[0] == ""){
		//	$("select[name=category_select]").val('category1');
		//}
		//
		//if($(this).attr('id').split('_')[0] == "category1"){
		//	$("select[name=category_select]").val('category2');
		//}
		//
		//if($(this).attr('id').split('_')[0] == "category2"){
		//	parent_id = $(this).attr('id').split('_')[2];
		//	$("select[name=category_select]").val('category3');
		//}
		//
		//if($(this).attr('id').split('_')[0] == "category3"){
		//	parent_id = $(this).attr('id').split('_')[2];
		//	$("select[name=category_select]").val('');
		//	//$("select[name=category_select]").attr("disabled", true);
		//}
	});
	var now_date = Date.now();
	var enroll_time = now_date/1000;


	function category_save(){
		var eles = $(".category_row:not(.desc)");

		var category1Arr = [];
		$.each(eles,function(n,e){
		 var cate1_eles = $(e).find(".category_1depth");
			 $.each(cate1_eles,function(m,c1){
			   var cate1Dict = {};
				 var category_name = $(c1).find(".top>input").val();
				 
				 cate1Dict['typeStr']='category1';
				 cate1Dict['category-name'] = category_name;
				 
				 var category2Arr = [];
				 var cate2_eles = $(c1).find(".category_2depth");
				 $.each(cate2_eles,function(a,c2){
				   var cate2Dict = {};
				   var category_name = $(c2).find(".top>input").val();
				 
					 cate2Dict['typeStr']='category2';
					 cate2Dict['category-name'] = category_name;
					 
					 var category3Arr = [];
					 var cate3_eles = $(c2).find(".category_3depth");
					 $.each(cate3_eles,function(b,c3){
							 var cate3Dict = {};
						   var category_name = $(c3).find(".top>input").val();
						 
							 cate3Dict['typeStr']='category3';
							 cate3Dict['category-name'] = category_name;
							 category3Arr.push(cate3Dict);
					 });
					 
					 cate2Dict['children'] = category3Arr;
					 
					 category2Arr.push(cate2Dict);
				 });
				 
				 cate1Dict['children'] = category2Arr;
				 category1Arr.push(cate1Dict);
			 })
		});

		console.log('**category1Arr',category1Arr);
	}

	function load_product_list(datas){
		console.log('datas',datas);
		var new_html = ``;

		for(var i = 0; i < datas.length; i++){
					
			var unix_timestamp = datas[i].enroll_time;
			var date = new Date(unix_timestamp * 1000);
            var hours = date.getHours();
            var minutes = "0" + date.getMinutes();
            var seconds = "0" + date.getSeconds();
            var mon = "0" + (date.getMonth()+1);
            var day = "0" + (date.getDate());
            var formattedTime = date.getFullYear() + "-" + mon.substr(-2) + "-" + day.substr(-2);
			
			var img_path = datas[i].main_img_url.replace("public","");
			
			var slider_show = 'slider';
			var tag = ``;
			if(datas[i].isShow == "YES"){
				slider_show = "slider2";
				tag += `<span id="product_hide" class="${slider_show}" onclick="set_product_not_showed(`+datas[i].id+`);"></span>`;
			}else{
				tag += `<span id="product_show" class="${slider_show}" onclick="set_product_showed(`+datas[i].id+`);"></span>`;
			}


			if(datas[i].isShow=="YES"){
				var isShow = "판매중";
			}
			var category_name = datas[i].category_id.split(">");
					new_html += `<tr>
										<td>
											<div class="adminContent_table_checkbox">
												<input id="check${datas[i].id}" type="checkbox">
												<label for="check${datas[i].id}"><span></span></label>
											</div>
										</td>
										<td>${page_num-i}</td>
										<td class="adminContent_table_name">
											<span class="adminContent_table_name_thumb" style="background: url(http://43.200.169.89`+img_path+`) no-repeat; background-size:cover;"></span>
											<p>`+datas[i].product_name+`</p>
										</td>
										<td>`+datas[i].wholesaler+`</td>
										<td>${category_name[1]} > ${category_name[2]}</td>
										<td>${datas[i].retail_price.toLocaleString('ko-KR')}원</td>
										<td>`+isShow+`</td>
										<td>`+datas[i].remain_count+`</td>
										<td>`+formattedTime+`</td>
										<td>${datas[i].delivery_fee.toLocaleString('ko-KR')}원</td>
										<td>
											<label class="switch">
												<input type="checkbox">
												${tag}
											</label>
										</td>
										<td>
											<div class="adminContent_order">
												<a href="javascript:void(0);" class="check_btn" onclick="modal_popup3();">수정</a>
											</div>
										</td>
									</tr>`;

			if(datas[i].user_type=="seller_J" || datas[i].user_type=="seller_I"){
				//$("#user_load_tbody").append(new_html);
				//user_count += 1;
			}
		}
		
		$("#product_load_tbody").html(new_html);

	}

	function product_load(){


		$.ajax({
			type : "GET",            // HTTP method type(GET, POST) 형식이다.
			url : "http://43.200.169.89/retail-products?user_id="+user_id,      // 컨트롤러에서 대기중인 URL 주소이다.
			data : {
				//user_id : user_id,
				//name : name,
				//user_id : 1,
				//name : "테스트의류",
				//enroll_time : enroll_time
				},            // Json 형식의 데이터이다.
			success : function(res){ // 비동기통신의 성공일경우 success콜백으로 들어옵니다. 'res'는 응답받은 데이터이다.
				// 응답코드 > 0000
				console.log(res);
				
				products = res;
				products_origin = res;

				var tmp_arr = products_origin.filter(function(product_info){
					return product_info.remain_count > 0;
				})

				var tmp_arr2 = products_origin.filter(function(product_info){
					return product_info.remain_count <= 0;
				})
				
				$(".total_num").text(products_origin.length);
				$(".sell_num").text(tmp_arr.length);
				$(".sold_num").text(tmp_arr2.length);

				$('#paging').pagination({
					dataSource: products,
					callback: function(data, pagination) {
						page_num = pagination.totalNumber - ((pagination.pageNumber-1) * pagination.pageSize);
						load_product_list(data);
					}
				});
				

			},
			error : function(XMLHttpRequest, textStatus, errorThrown){ // 비동기 통신이 실패할경우 error 콜백으로 들어옵니다.
				alert("통신 실패.")
			}
		});
	}
	function category_load(){
		$.ajax({
			type : "GET",            // HTTP method type(GET, POST) 형식이다.
			url : "http://43.200.169.89/categories",      // 컨트롤러에서 대기중인 URL 주소이다.
			data : {
				},            // Json 형식의 데이터이다.
			success : function(datas){ // 비동기통신의 성공일경우 success콜백으로 들어옵니다. 'res'는 응답받은 데이터이다.
				console.log(datas);
				var cate = JSON.parse(datas['categories']);
				console.log("cate",cate);

				var tag = ``;
				var tag2 = ``;
				var tag3 = ``;

				for(var i = 0; i < cate.length; i++){
					if(cate[i].children.length != 0){
						for(var j = 0; j < cate[i].children.length; j++){
							if(cate[i].children[j].children.length != 0){
								for(var k = 0; k < cate[i].children[j].children.length; k++){
									console.log('test');
									tag3 += `<option value="${cate[i].category_name}>${cate[i].children[j].category_name}>${cate[i].children[j].children[k].category_name}">${cate[i].children[j].category_name} > ${cate[i].children[j].children[k].category_name}</option>`;
								}
								
							}
						}
						
					}

					tag2 = ``; // 초기화

				}
				console.log(tag3);
				$(".product_category").append(tag3);
				

			},
			error : function(XMLHttpRequest, textStatus, errorThrown){ // 비동기 통신이 실패할경우 error 콜백으로 들어옵니다.
				alert("통신 실패.")
			}
		});
	}
	function category_add(){
		var tag = ``;

		if(checked_type==0){
			tag += `<div class="category_row">
							<div class="category_1depth">
								<div class="top">
									<input id="category1_id_1" type="checkbox" name="category_chkbox" data-type="category1">
									<input type="text" name="category_text" hint="대분류">
								</div>
								<div class="bottom_list">
								</div>
							</div>
						</div>`;

			//$(".category_section").prepend(tag);
			//$(".category_section").prepend(tag);
			$(".category_row.desc").after(tag);
			$(".category_section").find("input[name=category_text]")[0].focus();
		
		}else if(checked_type==1){

			tag += `<div class="category_2depth">
								<div class="top">
									<input id="category2_id_1" type="checkbox" name="category_chkbox" data-type="category2">
									<input type="text" name="category_text" hint="중분류">
								</div>
								<div class="bottom_list">
								</div>
							</div>`;
			$($( "input[name='category_chkbox']:checked" ).parent().parent().find('.bottom_list')[0]).prepend(tag);
			
			$( "input[name='category_chkbox']:checked" ).parent().parent().find('.bottom_list').find("input[name=category_text]")[0].focus();


		}else if(checked_type==2){
			
			tag += `<div class="category_3depth">
								<div class="top">
									<input id="category3_id_1" type="checkbox" name="category_chkbox" data-type="category3">
									<input type="text" name="category_text" hint="소분류">
								</div>
								<div class="bottom_list">
								</div>
							</div>`;
			$($( "input[name='category_chkbox']:checked" ).parent().parent().find('.bottom_list')[0]).prepend(tag);
			$( "input[name='category_chkbox']:checked" ).parent().parent().find('.bottom_list').find("input[name=category_text]")[0].focus();

		}
		
		
	}
	
	function category_modify(){
	
	}
	
	function category_delete(){
		
		var category_chk = $('input:checkbox[type=checkbox]:checked').attr('id');
		if(category_chk == undefined){
			alert('카테고리를 선택해주세요.');
			return false;
		}
		console.log(category_chk);//category3_id_1
		var category_num = category_chk.substr(8,1);
		var category_id = category_chk.split("_");
		console.log(category_id[2]);
		//return false;
		
		// ajax 통신
		$.ajax({
			type : "POST",            // HTTP method type(GET, POST) 형식이다.
			url : "http://43.200.169.89/delete-category"+category_num,      // 컨트롤러에서 대기중인 URL 주소이다.
			data : {
				user_id : 1,
				category_id : category_id[2]
				},            // Json 형식의 데이터이다.
			success : function(res){ // 비동기통신의 성공일경우 success콜백으로 들어옵니다. 'res'는 응답받은 데이터이다.
				// 응답코드 > 0000
				//alert(res);

				if(res == "success"){
					alert("카테고리가 삭제 되었습니다.");
					//category_load();
				}else{
					alert("오류 발생. 관리자에게 문의하세요.");
				}
			},
			error : function(XMLHttpRequest, textStatus, errorThrown){ // 비동기 통신이 실패할경우 error 콜백으로 들어옵니다.
				alert("통신 실패.")
			}
		});
	}
	function product_valid(){
		var product_name = $("input[name=product_name]").val();
		var product_domae = $("input[name=product_domae]").val();
		var product_category = $("select[name=product_category]").val();
		var product_domae_price = $("input[name=product_domae_price]").val();
		var product_price = $("input[name=product_price]").val();
		var product_amount = $("input[name=product_amount]").val();
		var product_deli = $("input[name=product_deli]").val();
		var start_date = $("#new_start_date").val();
		var end_date = $("#new_end_date").val();
		//var product_content = $("textarea[name=product_content]").val();
		//start_date = start_date/1000;
		//console.log(start_date);
		if(product_name==""){
			alert("상품명을 입력해주세요.");
			return false;
		}
		if(product_domae==""){
			alert("도매처를 입력해주세요.");
			return false;
		}
		if(product_domae_price==""){
			alert("도매가를 입력해주세요.");
			return false;
		}
		if(product_price==""){
			alert("소매 지정 판매가를 입력해주세요.");
			return false;
		}
		if(product_amount==""){
			alert("재고를 입력해주세요.");
			return false;
		}
		if(product_deli==""){
			alert("배송비를 입력해주세요.");
			return false;
		}
		if(start_date==""){
			alert("상품 업로드 시작을 입력해주세요.");
			return false;
		}
		if(end_date==""){
			alert("상품 업로드 종료를 입력해주세요.");
			return false;
		}
		
		$('.modalPage01').hide();
		$('.modalPage02').show();

	}
	function product_add(){
		
        if($("#main_img").val()==""){
            alert("메인 사진을 입력해주세요.");
            return false;
        }
        var options = [];
		var eles = $('.option_div');

		$.each(eles,function(n,e){
		   var option_dict = {};
		   var option_name = $(e).find("input[name='option_name']").val();
		   
		   var s_inputs = $(e).find("input[name='option_selections']");
		   
		   var option_selections = [];
		   $.each(s_inputs,function(m,input){
			  option_selections.push($(input).val());
		   })
		   
		   option_dict['option_name'] = option_name;
		   option_dict['selections'] = option_selections;
		   
		   options.push(option_dict);
		   
		});
		options = JSON.stringify(options);

		var product_name = $("input[name=product_name]").val();
		var product_domae = $("input[name=product_domae]").val();
		var product_category = $("select[name=product_category]").val();
		var product_domae_price = $("input[name=product_domae_price]").val();
		var product_price = $("input[name=product_price]").val();
		var product_amount = $("input[name=product_amount]").val();
		var product_deli = $("input[name=product_deli]").val();
		var start_date = $("input[name=start_date]").val();
		var end_date = $("input[name=end_date]").val();
		var product_content = $("textarea[name=product_content]").val();
		//console.log(product_content);
		//return false;
		var form = $('#uploadForm')[0];
		var form_data = new FormData();
		
		form_data.append('user_id', user_id);
		form_data.append('product_name', product_name);
		form_data.append('wholesaler', product_domae);
		form_data.append('category_id', product_category);
		form_data.append('wholesale_price', product_domae_price);
		form_data.append('retail_price', product_price);
		form_data.append('remain_count', product_amount);
		form_data.append('delivery_fee', product_deli);
		form_data.append('start_time', start_date);
		form_data.append('end_time', end_date);
		form_data.append('descStr', product_content);
		form_data.append('enroll_time', enroll_time);
		form_data.append('file', $("#main_img")[0].files[0]);
        form_data.append('options', options);
		
		console.log(form_data);
        //return;
		// ajax 통신
		$.ajax({
			type : "POST",            // HTTP method type(GET, POST) 형식이다.
			url : "http://43.200.169.89/enroll-retail-product",      // 컨트롤러에서 대기중인 URL 주소이다.
			contentType: false,
			processData: false,
			//enctype: 'multipart/form-data',
			data : form_data,            // Json 형식의 데이터이다.
			success : function(res){ // 비동기통신의 성공일경우 success콜백으로 들어옵니다. 'res'는 응답받은 데이터이다.
				// 응답코드 > 0000
				console.log(res);
				var new_res = res.split('__');
				if(new_res[0] == "success"){
					$('.modalPage03').hide();
			        $('.modalPage04').show();
				}else{
					alert("오류 발생. 관리자에게 문의하세요.");
				}
			},
			error : function(XMLHttpRequest, textStatus, errorThrown){ // 비동기 통신이 실패할경우 error 콜백으로 들어옵니다.
				alert("통신 실패.")
			}
		});
	}

	function set_product_showed(product_id){
		// ajax 통신
		$.ajax({
			type : "POST",            // HTTP method type(GET, POST) 형식이다.
			url : "http://43.200.169.89/set_product_showed",      // 컨트롤러에서 대기중인 URL 주소이다.
			data : {
					product_id : product_id
				},            // Json 형식의 데이터이다.
			success : function(res){ // 비동기통신의 성공일경우 success콜백으로 들어옵니다. 'res'는 응답받은 데이터이다.
				// 응답코드 > 0000
				//alert(res);

				if(res == "success"){
					location.reload();
				}else{
					alert("오류 발생. 관리자에게 문의하세요.");
				}
			},
			error : function(XMLHttpRequest, textStatus, errorThrown){ // 비동기 통신이 실패할경우 error 콜백으로 들어옵니다.
				alert("통신 실패.")
			}
		});
	}

	function set_product_not_showed(product_id){
		// ajax 통신
		$.ajax({
			type : "POST",            // HTTP method type(GET, POST) 형식이다.
			url : "http://43.200.169.89/set_product_not_showed",      // 컨트롤러에서 대기중인 URL 주소이다.
			data : {
					product_id : product_id
				},            // Json 형식의 데이터이다.
			success : function(res){ // 비동기통신의 성공일경우 success콜백으로 들어옵니다. 'res'는 응답받은 데이터이다.
				// 응답코드 > 0000
				//alert(res);

				if(res == "success"){
					location.reload();
				}else{
					alert("오류 발생. 관리자에게 문의하세요.");
				}
			},
			error : function(XMLHttpRequest, textStatus, errorThrown){ // 비동기 통신이 실패할경우 error 콜백으로 들어옵니다.
				alert("통신 실패.")
			}
		});
	}

	function set_best_product_showed(product_id){
		// ajax 통신
		$.ajax({
			type : "POST",            // HTTP method type(GET, POST) 형식이다.
			url : "http://43.200.169.89/check-best-item",      // 컨트롤러에서 대기중인 URL 주소이다.
			data : {
					product_id : product_id
				},            // Json 형식의 데이터이다.
			success : function(res){ // 비동기통신의 성공일경우 success콜백으로 들어옵니다. 'res'는 응답받은 데이터이다.
				// 응답코드 > 0000
				//alert(res);

				if(res == "success"){
					alert("베스트아이템 보이기가 적용되었습니다.");
					$("#best_product_show").hide();
					$("#best_product_hide").show();
				}else{
					alert("오류 발생. 관리자에게 문의하세요.");
				}
			},
			error : function(XMLHttpRequest, textStatus, errorThrown){ // 비동기 통신이 실패할경우 error 콜백으로 들어옵니다.
				alert("통신 실패.")
			}
		});
	}

	function set_best_product_not_showed(product_id){
		// ajax 통신
		$.ajax({
			type : "POST",            // HTTP method type(GET, POST) 형식이다.
			url : "http://43.200.169.89/uncheck-best-item",      // 컨트롤러에서 대기중인 URL 주소이다.
			data : {
					product_id : product_id
				},            // Json 형식의 데이터이다.
			success : function(res){ // 비동기통신의 성공일경우 success콜백으로 들어옵니다. 'res'는 응답받은 데이터이다.
				// 응답코드 > 0000
				//alert(res);

				if(res == "success"){
					alert("베스트아이템 숨기기가 적용되었습니다.");
					$("#best_product_show").show();
					$("#best_product_hide").hide();
				}else{
					alert("오류 발생. 관리자에게 문의하세요.");
				}
			},
			error : function(XMLHttpRequest, textStatus, errorThrown){ // 비동기 통신이 실패할경우 error 콜백으로 들어옵니다.
				alert("통신 실패.")
			}
		});
	}

	function option_plus(){
		
	}
	$("body").on("click",".option_plus", function(e){
		var option_html = `<p><input type="text" name="option_selections" placeholder="옵션을 입력해주세요"></p>`;
		$(e.target).before(option_html);
	})
	function option_add(){
        
        var exit = false;

        jQuery('.option_name').each(function() {
            var currentElement = $(this);

            var value = currentElement.val(); // if it is an input/select/textarea field
            if(value == ""){
                alert("옵션명을 입력해주세요.");
                exit = true;
                return false;
            }
        });
        if(exit){
            return false;
        }

        var exit2 = false;
        jQuery('.option_selections').each(function() {
            var currentElement = $(this);

            var value = currentElement.val(); // if it is an input/select/textarea field
            if(value == ""){
                alert("옵션을 입력해주세요.");
                exit2 = true;
                return false;
            }
        });
		if(exit2){
            return false;
        }

        $('.modalPage02').hide();
		$('.modalPage03').show();

		// var options = [];
		// var eles = $('.option_div');

		// $.each(eles,function(n,e){
		//    var option_dict = {};
		//    var option_name = $(e).find("input[name='option_name']").val();
		   
		//    var s_inputs = $(e).find("input[name='option_selections']");
		   
		//    var option_selections = [];
		//    $.each(s_inputs,function(m,input){
		// 	  option_selections.push($(input).val());
		//    })
		   
		//    option_dict['option_name'] = option_name;
		//    option_dict['selections'] = option_selections;
		   
		//    options.push(option_dict);
		   
		// });
		// options = JSON.stringify(options);
		// console.log(options);
		// //return false;

		// $.ajax({
		// 	type : "POST",            // HTTP method type(GET, POST) 형식이다.
		// 	url : "http://43.200.169.89/add-option",      // 컨트롤러에서 대기중인 URL 주소이다.
		// 	data : {
		// 			product_id : 14,
		// 			options : options
		// 		},            // Json 형식의 데이터이다.
		// 	success : function(res){ // 비동기통신의 성공일경우 success콜백으로 들어옵니다. 'res'는 응답받은 데이터이다.
		// 		// 응답코드 > 0000
		// 		//alert(res);

		// 		if(res == "success"){
		// 			alert("옵션이 추가되었습니다.");
		// 		}else{
		// 			alert("오류 발생. 관리자에게 문의하세요.");
		// 		}
		// 	},
		// 	error : function(XMLHttpRequest, textStatus, errorThrown){ // 비동기 통신이 실패할경우 error 콜백으로 들어옵니다.
		// 		alert("통신 실패.")
		// 	}
		// });
	}

	$(".plusbtn").click(function(){
		
		var tag = `<div class="option_div">
						<p><input type="text" class="option_name" name="option_name" placeholder="옵션명 입력"></p>
						<p id="option_p"><input type="text" class="option_selections" name="option_selections" placeholder="옵션을 입력해주세요"></p>
						<a style="text-align:center;" class="option_plus" id="option_plus" onclick="option_plus()" href="javascript:void(0)">+</a>
					</div>`;
		
		$("#first_option_div").after(tag);

	});

	$(".filter_all").click(function(e){ // 판매중 클릭시 필터
		
		$("input[name=search_product]").val('');

		$('#paging').pagination({
			dataSource: products_origin,
			callback: function(data, pagination) {
				page_num = pagination.totalNumber - ((pagination.pageNumber-1) * pagination.pageSize);
				load_product_list(data);
			}
		});

		$(this).addClass("active");
		$(this).siblings().removeClass("active");

	})

	$(".filter_sell").click(function(e){ // 판매중 클릭시 필터
		
		$("input[name=search_product]").val('');

		products = products_origin.filter(function(product_info){
			return product_info.remain_count > 0;
		})

		$('#paging').pagination({
			dataSource: products,
			callback: function(data, pagination) {
				page_num = pagination.totalNumber - ((pagination.pageNumber-1) * pagination.pageSize);
				load_product_list(data);
			}
		});

		$(this).addClass("active");
		$(this).siblings().removeClass("active");

	})

	$(".filter_sold").click(function(e){ // 판매중 클릭시 필터
		
		$("input[name=search_product]").val('');

		products = products_origin.filter(function(product_info){
			return product_info.remain_count <= 0;
		})

		$('#paging').pagination({
			dataSource: products,
			callback: function(data, pagination) {
				page_num = pagination.totalNumber - ((pagination.pageNumber-1) * pagination.pageSize);
				load_product_list(data);
			}
		});

		$(this).addClass("active");
		$(this).siblings().removeClass("active");

	})
	
	$(".search_btn").click(function(e){
		var search_word = $("input[name=search_product]").val();
		
		products = products_origin.filter(function(product_info){
			return product_info.product_name.indexOf(search_word) > -1;
		})

		$('#paging').pagination({
			dataSource: products,
			callback: function(data, pagination) {
				page_num = pagination.totalNumber - ((pagination.pageNumber-1) * pagination.pageSize);
				load_product_list(data);
			}
		});
	})
	
	function enterkey(){
		if (window.event.keyCode == 13) {
			var search_word = $("input[name=search_product]").val();
		
			products = products_origin.filter(function(product_info){
				return product_info.product_name.indexOf(search_word) > -1;
			})

			$('#paging').pagination({
				dataSource: products,
				callback: function(data, pagination) {
					page_num = pagination.totalNumber - ((pagination.pageNumber-1) * pagination.pageSize);
					load_product_list(data);
				}
			});
		}
	}
</script>
